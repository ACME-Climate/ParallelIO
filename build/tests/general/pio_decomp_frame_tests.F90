! DON'T MODIFY THIS FILE, ALL YOUR CHANGES WILL BE LOST
! This file is generated by ../../../tests/general/util/pio_tf_f90gen.pl
! from /home/tkurc/codar/e3sm/pio_adios1/ParallelIO/tests/general/pio_decomp_frame_tests.F90.in

! Write multiple frames of a 2d variable with an unlimited dimension


SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:3
  implicit none   ! pio_decomp_frame_tests.F90.in:4
  integer, parameter :: NDIMS = 2   ! pio_decomp_frame_tests.F90.in:5
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:6
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_decomp_frame_tests.F90.in:7
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:8
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:9
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:10
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:11
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:12
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:13
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:14
  integer, dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:15
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:16
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:17
  integer :: i, nrows, ierr, lsz   ! pio_decomp_frame_tests.F90.in:18
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:19
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:21
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:22
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:23
   ! pio_decomp_frame_tests.F90.in:24
  ! Data evenly distributed across all procs
  ! Each proc has VEC_LOCAL_SZ elements on each frame
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_decomp_frame_tests.F90.in:27
  start(1) = VEC_LOCAL_SZ * pio_tf_world_rank_ + 1   ! pio_decomp_frame_tests.F90.in:28
  start(2) = 1   ! pio_decomp_frame_tests.F90.in:29
  count(1) = VEC_LOCAL_SZ   ! pio_decomp_frame_tests.F90.in:30
  count(2) = 1   ! pio_decomp_frame_tests.F90.in:31
   ! pio_decomp_frame_tests.F90.in:32
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:33
   ! pio_decomp_frame_tests.F90.in:34
  allocate(wbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:35
  allocate(rbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:36
  rbuf = 0   ! pio_decomp_frame_tests.F90.in:37
  allocate(exp_val(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:38
  allocate(compdof(nrows))   ! pio_decomp_frame_tests.F90.in:39
  do i=1,nrows   ! pio_decomp_frame_tests.F90.in:40
    compdof(i) = start(1) - 1 + i   ! pio_decomp_frame_tests.F90.in:41
  end do   ! pio_decomp_frame_tests.F90.in:42
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:43
    do i=1,nrows   ! pio_decomp_frame_tests.F90.in:44
      wbuf(i,f) = compdof(i) + (f-1) * dims(1)   ! pio_decomp_frame_tests.F90.in:45
      exp_val(i,f) = wbuf(i,f)   ! pio_decomp_frame_tests.F90.in:46
    end do   ! pio_decomp_frame_tests.F90.in:47
  end do   ! pio_decomp_frame_tests.F90.in:48
   ! pio_decomp_frame_tests.F90.in:49
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:50
   ! pio_decomp_frame_tests.F90.in:51
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:52
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:53
   ! pio_decomp_frame_tests.F90.in:54
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:55
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:56
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:57
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:58

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:59
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:60
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:61)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:61
   ! pio_decomp_frame_tests.F90.in:62
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:63
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:64)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:64
   ! pio_decomp_frame_tests.F90.in:65
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(2))   ! pio_decomp_frame_tests.F90.in:66
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:67)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:67
   ! pio_decomp_frame_tests.F90.in:68
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:69
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:70)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:70
   ! pio_decomp_frame_tests.F90.in:71
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:72
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:73)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:73
   ! pio_decomp_frame_tests.F90.in:74
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:75
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:76
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:78
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:79)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:79
    end do   ! pio_decomp_frame_tests.F90.in:80
   ! pio_decomp_frame_tests.F90.in:81
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:83
   ! pio_decomp_frame_tests.F90.in:84
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:85
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:86)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:86
   ! pio_decomp_frame_tests.F90.in:87
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:88
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:89)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:89
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:91
#endif
   ! pio_decomp_frame_tests.F90.in:93
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:94
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:95
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:96
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:97)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:97
    end do   ! pio_decomp_frame_tests.F90.in:98
   ! pio_decomp_frame_tests.F90.in:99
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:100
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,f), exp_val(:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:101)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:101
    end do   ! pio_decomp_frame_tests.F90.in:102
   ! pio_decomp_frame_tests.F90.in:103
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:104
       ! pio_decomp_frame_tests.F90.in:105
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:106
  end do   ! pio_decomp_frame_tests.F90.in:107
   ! pio_decomp_frame_tests.F90.in:108
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:109
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:110
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:111
  end if   ! pio_decomp_frame_tests.F90.in:112
   ! pio_decomp_frame_tests.F90.in:113
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:114
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:115
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:116
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:117
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:118
END SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_int_integer__   ! pio_decomp_frame_tests.F90.in:119


SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:3
  implicit none   ! pio_decomp_frame_tests.F90.in:4
  integer, parameter :: NDIMS = 2   ! pio_decomp_frame_tests.F90.in:5
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:6
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_decomp_frame_tests.F90.in:7
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:8
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:9
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:10
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:11
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:12
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:13
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:14
  real(kind=fc_real), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:15
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:16
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:17
  integer :: i, nrows, ierr, lsz   ! pio_decomp_frame_tests.F90.in:18
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:19
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:21
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:22
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:23
   ! pio_decomp_frame_tests.F90.in:24
  ! Data evenly distributed across all procs
  ! Each proc has VEC_LOCAL_SZ elements on each frame
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_decomp_frame_tests.F90.in:27
  start(1) = VEC_LOCAL_SZ * pio_tf_world_rank_ + 1   ! pio_decomp_frame_tests.F90.in:28
  start(2) = 1   ! pio_decomp_frame_tests.F90.in:29
  count(1) = VEC_LOCAL_SZ   ! pio_decomp_frame_tests.F90.in:30
  count(2) = 1   ! pio_decomp_frame_tests.F90.in:31
   ! pio_decomp_frame_tests.F90.in:32
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:33
   ! pio_decomp_frame_tests.F90.in:34
  allocate(wbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:35
  allocate(rbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:36
  rbuf = 0   ! pio_decomp_frame_tests.F90.in:37
  allocate(exp_val(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:38
  allocate(compdof(nrows))   ! pio_decomp_frame_tests.F90.in:39
  do i=1,nrows   ! pio_decomp_frame_tests.F90.in:40
    compdof(i) = start(1) - 1 + i   ! pio_decomp_frame_tests.F90.in:41
  end do   ! pio_decomp_frame_tests.F90.in:42
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:43
    do i=1,nrows   ! pio_decomp_frame_tests.F90.in:44
      wbuf(i,f) = compdof(i) + (f-1) * dims(1)   ! pio_decomp_frame_tests.F90.in:45
      exp_val(i,f) = wbuf(i,f)   ! pio_decomp_frame_tests.F90.in:46
    end do   ! pio_decomp_frame_tests.F90.in:47
  end do   ! pio_decomp_frame_tests.F90.in:48
   ! pio_decomp_frame_tests.F90.in:49
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:50
   ! pio_decomp_frame_tests.F90.in:51
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:52
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:53
   ! pio_decomp_frame_tests.F90.in:54
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:55
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:56
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:57
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:58

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:59
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:60
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:61)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:61
   ! pio_decomp_frame_tests.F90.in:62
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:63
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:64)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:64
   ! pio_decomp_frame_tests.F90.in:65
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(2))   ! pio_decomp_frame_tests.F90.in:66
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:67)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:67
   ! pio_decomp_frame_tests.F90.in:68
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:69
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:70)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:70
   ! pio_decomp_frame_tests.F90.in:71
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:72
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:73)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:73
   ! pio_decomp_frame_tests.F90.in:74
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:75
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:76
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:78
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:79)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:79
    end do   ! pio_decomp_frame_tests.F90.in:80
   ! pio_decomp_frame_tests.F90.in:81
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:83
   ! pio_decomp_frame_tests.F90.in:84
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:85
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:86)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:86
   ! pio_decomp_frame_tests.F90.in:87
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:88
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:89)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:89
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:91
#endif
   ! pio_decomp_frame_tests.F90.in:93
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:94
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:95
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:96
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:97)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:97
    end do   ! pio_decomp_frame_tests.F90.in:98
   ! pio_decomp_frame_tests.F90.in:99
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:100
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,f), exp_val(:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:101)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:101
    end do   ! pio_decomp_frame_tests.F90.in:102
   ! pio_decomp_frame_tests.F90.in:103
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:104
       ! pio_decomp_frame_tests.F90.in:105
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:106
  end do   ! pio_decomp_frame_tests.F90.in:107
   ! pio_decomp_frame_tests.F90.in:108
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:109
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:110
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:111
  end if   ! pio_decomp_frame_tests.F90.in:112
   ! pio_decomp_frame_tests.F90.in:113
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:114
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:115
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:116
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:117
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:118
END SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___   ! pio_decomp_frame_tests.F90.in:119


SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:3
  implicit none   ! pio_decomp_frame_tests.F90.in:4
  integer, parameter :: NDIMS = 2   ! pio_decomp_frame_tests.F90.in:5
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:6
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_decomp_frame_tests.F90.in:7
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:8
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:9
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:10
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:11
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:12
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:13
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:14
  real(kind=fc_double), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:15
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:16
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:17
  integer :: i, nrows, ierr, lsz   ! pio_decomp_frame_tests.F90.in:18
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:19
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:21
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:22
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:23
   ! pio_decomp_frame_tests.F90.in:24
  ! Data evenly distributed across all procs
  ! Each proc has VEC_LOCAL_SZ elements on each frame
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_decomp_frame_tests.F90.in:27
  start(1) = VEC_LOCAL_SZ * pio_tf_world_rank_ + 1   ! pio_decomp_frame_tests.F90.in:28
  start(2) = 1   ! pio_decomp_frame_tests.F90.in:29
  count(1) = VEC_LOCAL_SZ   ! pio_decomp_frame_tests.F90.in:30
  count(2) = 1   ! pio_decomp_frame_tests.F90.in:31
   ! pio_decomp_frame_tests.F90.in:32
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:33
   ! pio_decomp_frame_tests.F90.in:34
  allocate(wbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:35
  allocate(rbuf(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:36
  rbuf = 0   ! pio_decomp_frame_tests.F90.in:37
  allocate(exp_val(nrows, NFRAMES))   ! pio_decomp_frame_tests.F90.in:38
  allocate(compdof(nrows))   ! pio_decomp_frame_tests.F90.in:39
  do i=1,nrows   ! pio_decomp_frame_tests.F90.in:40
    compdof(i) = start(1) - 1 + i   ! pio_decomp_frame_tests.F90.in:41
  end do   ! pio_decomp_frame_tests.F90.in:42
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:43
    do i=1,nrows   ! pio_decomp_frame_tests.F90.in:44
      wbuf(i,f) = compdof(i) + (f-1) * dims(1)   ! pio_decomp_frame_tests.F90.in:45
      exp_val(i,f) = wbuf(i,f)   ! pio_decomp_frame_tests.F90.in:46
    end do   ! pio_decomp_frame_tests.F90.in:47
  end do   ! pio_decomp_frame_tests.F90.in:48
   ! pio_decomp_frame_tests.F90.in:49
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:50
   ! pio_decomp_frame_tests.F90.in:51
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:52
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:53
   ! pio_decomp_frame_tests.F90.in:54
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:55
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:56
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:57
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:58

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:59
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:60
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:61)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:61
   ! pio_decomp_frame_tests.F90.in:62
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:63
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:64)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:64
   ! pio_decomp_frame_tests.F90.in:65
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(2))   ! pio_decomp_frame_tests.F90.in:66
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:67)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:67
   ! pio_decomp_frame_tests.F90.in:68
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:69
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:70)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:70
   ! pio_decomp_frame_tests.F90.in:71
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:72
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:73)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:73
   ! pio_decomp_frame_tests.F90.in:74
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:75
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:76
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:78
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:79)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:79
    end do   ! pio_decomp_frame_tests.F90.in:80
   ! pio_decomp_frame_tests.F90.in:81
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:83
   ! pio_decomp_frame_tests.F90.in:84
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:85
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:86)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:86
   ! pio_decomp_frame_tests.F90.in:87
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:88
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:89)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:89
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:91
#endif
   ! pio_decomp_frame_tests.F90.in:93
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:94
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:95
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,f), ierr)   ! pio_decomp_frame_tests.F90.in:96
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:97)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:97
    end do   ! pio_decomp_frame_tests.F90.in:98
   ! pio_decomp_frame_tests.F90.in:99
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:100
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,f), exp_val(:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:101)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:101
    end do   ! pio_decomp_frame_tests.F90.in:102
   ! pio_decomp_frame_tests.F90.in:103
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:104
       ! pio_decomp_frame_tests.F90.in:105
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:106
  end do   ! pio_decomp_frame_tests.F90.in:107
   ! pio_decomp_frame_tests.F90.in:108
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:109
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:110
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:111
  end if   ! pio_decomp_frame_tests.F90.in:112
   ! pio_decomp_frame_tests.F90.in:113
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:114
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:115
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:116
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:117
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:118
END SUBROUTINE nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___   ! pio_decomp_frame_tests.F90.in:119
   ! pio_decomp_frame_tests.F90.in:119


! Get a 3D column decomposition
! If force_rearrange is FALSE, the decomposition is such that
! # All even procs have VEC_HGT_SZ blocks of 
! (VEC_COL_SZ rows x VEC_ROW_SZ columns) elements
! # All odd procs have  VEC_HGT_SZ blocks of
! (VEC_COL_SZ rows x VEC_ROW_SZ + 1 columns) elements
! e.g. For VEC_ROW_SZ = 2, VEC_COL_SZ = 2, VEC_HGT_SZ = 2
! and ranks 0, 1, 2,
! e.g. 1) |(1,1,1) (1,2,1) (2,1,1) (2,2,1)|
!         |(1,1,2) (1,2,2) (2,1,2) (2,2,2)| ,
!         |(1,3,1) (1,4,1) (1,5,1) (2,3,1) (2,4,1) (2,5,1)|
!         |(1,3,2) (1,4,2) (1,5,2) (2,3,2) (2,4,2) (2,5,2)|,
!         |(1,6,1) (1,7,1) (2,6,1) (2,7,1)|
!         |(1,6,2) (1,7,2) (2,6,2) (2,7,2)|
! If force_rearrange is TRUE, the decomposition is such that,
! If possible, the even rank "exchanges" elements with the next
! higher ranked odd proc.
! e.g. For VEC_ROW_SZ = 2, VEC_COL_SZ = 2, VEC_HGT_SZ = 2
! and ranks 0, 1, 2,
! e.g. 1  |(1,3,1) (1,4,1) (1,5,1) (2,3,1) (2,4,1) (2,5,1)|
!         |(1,3,2) (1,4,2) (1,5,2) (2,3,2) (2,4,2) (2,5,2)|,
!         |(1,1,1) (1,2,1) (2,1,1) (2,2,1)|
!         |(1,1,2) (1,2,2) (2,1,2) (2,2,2)| ,
!         |(1,6,1) (1,7,1) (2,6,1) (2,7,1)|
!         |(1,6,2) (1,7,2) (2,6,2) (2,7,2)|
! This for example can be used to force rearrangement when reading
! or writing data.
SUBROUTINE get_3d_col_decomp_info(rank, sz, dims, start, count, force_rearrange)   ! pio_decomp_frame_tests.F90.in:148
  integer, parameter :: VEC_ROW_SZ = 2   ! pio_decomp_frame_tests.F90.in:149
  integer, parameter :: VEC_COL_SZ = 2   ! pio_decomp_frame_tests.F90.in:150
  integer, parameter :: VEC_HGT_SZ = 2   ! pio_decomp_frame_tests.F90.in:151
  integer, parameter :: NDIMS = 3   ! pio_decomp_frame_tests.F90.in:152
  integer, intent(in) :: rank   ! pio_decomp_frame_tests.F90.in:153
  integer, intent(in) :: sz   ! pio_decomp_frame_tests.F90.in:154
  integer, dimension(NDIMS), intent(out) :: dims   ! pio_decomp_frame_tests.F90.in:155
  integer, dimension(NDIMS), intent(out) :: start   ! pio_decomp_frame_tests.F90.in:156
  integer, dimension(NDIMS), intent(out) :: count   ! pio_decomp_frame_tests.F90.in:157
  logical, intent(in) :: force_rearrange   ! pio_decomp_frame_tests.F90.in:158


  logical :: is_even_rank   ! pio_decomp_frame_tests.F90.in:160
  integer :: num_odd_procs, num_even_procs   ! pio_decomp_frame_tests.F90.in:161
  integer :: iodd, ieven   ! pio_decomp_frame_tests.F90.in:162


  is_even_rank = .false.   ! pio_decomp_frame_tests.F90.in:164
  if (mod(rank, 2) == 0) then   ! pio_decomp_frame_tests.F90.in:165
    is_even_rank = .true.   ! pio_decomp_frame_tests.F90.in:166
  end if   ! pio_decomp_frame_tests.F90.in:167
  num_odd_procs = sz / 2   ! pio_decomp_frame_tests.F90.in:168
  num_even_procs = sz - num_odd_procs   ! pio_decomp_frame_tests.F90.in:169
  dims(1) = VEC_COL_SZ   ! pio_decomp_frame_tests.F90.in:170
  dims(2) = num_even_procs * VEC_ROW_SZ + num_odd_procs * (VEC_ROW_SZ + 1)   ! pio_decomp_frame_tests.F90.in:171
  dims(3) = VEC_HGT_SZ   ! pio_decomp_frame_tests.F90.in:172
  ! Number of odd and even procs before this rank
  iodd = rank / 2   ! pio_decomp_frame_tests.F90.in:174
  ieven = (rank + 1) / 2   ! pio_decomp_frame_tests.F90.in:175


  ! Rows
  start(1) = 1   ! pio_decomp_frame_tests.F90.in:178
  count(1) = VEC_COL_SZ   ! pio_decomp_frame_tests.F90.in:179


  ! Columns
  if(force_rearrange) then   ! pio_decomp_frame_tests.F90.in:182
    ! Make sure that we force rearrangement
    if (is_even_rank) then   ! pio_decomp_frame_tests.F90.in:184
      if(rank + 1 < sz) then   ! pio_decomp_frame_tests.F90.in:185
        ! Force rearrangement
        count(2) = VEC_ROW_SZ + 1   ! pio_decomp_frame_tests.F90.in:187
        start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + (VEC_ROW_SZ) + 1   ! pio_decomp_frame_tests.F90.in:188
      else   ! pio_decomp_frame_tests.F90.in:189
        count(2) = VEC_ROW_SZ   ! pio_decomp_frame_tests.F90.in:190
        start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + 1   ! pio_decomp_frame_tests.F90.in:191
      end if   ! pio_decomp_frame_tests.F90.in:192
    else   ! pio_decomp_frame_tests.F90.in:193
      ! For all odd procs there is an even lower ranked, rank-1, proc
      ! So force rearrangement
      count(2) = VEC_ROW_SZ   ! pio_decomp_frame_tests.F90.in:196
      start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) - (VEC_ROW_SZ) + 1   ! pio_decomp_frame_tests.F90.in:197
    end if   ! pio_decomp_frame_tests.F90.in:198
  else   ! pio_decomp_frame_tests.F90.in:199
    if (is_even_rank) then   ! pio_decomp_frame_tests.F90.in:200
      count(2) = VEC_ROW_SZ   ! pio_decomp_frame_tests.F90.in:201
    else   ! pio_decomp_frame_tests.F90.in:202
      count(2) = VEC_ROW_SZ + 1   ! pio_decomp_frame_tests.F90.in:203
    end if   ! pio_decomp_frame_tests.F90.in:204
    start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + 1   ! pio_decomp_frame_tests.F90.in:205
  end if   ! pio_decomp_frame_tests.F90.in:206


  ! Height
  start(3) = 1   ! pio_decomp_frame_tests.F90.in:209
  count(3) = VEC_HGT_SZ   ! pio_decomp_frame_tests.F90.in:210
END SUBROUTINE   ! pio_decomp_frame_tests.F90.in:211


! Write with one decomp (to force rearrangement) and read with another (no
! rearrangement)


SUBROUTINE nc_write_read_4d_col_decomp_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:216
  implicit none   ! pio_decomp_frame_tests.F90.in:217
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:218
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:219
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:220
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:221
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:222
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:223
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:224
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:225
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:226
  integer, dimension(:,:,:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:227
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:228
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:229
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:230
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:231
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:233
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:234
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:235
   ! pio_decomp_frame_tests.F90.in:236
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:238
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:239
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:240
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:241
     ! pio_decomp_frame_tests.F90.in:242
  allocate(wbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:243
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:244
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:245
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:246
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:247
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:248
          wbuf(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:249
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:250
          wbuf(i,j,k,f) = wbuf(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:251
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:252
          compdof(tmp_idx) = wbuf(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:253
        end do   ! pio_decomp_frame_tests.F90.in:254
      end do   ! pio_decomp_frame_tests.F90.in:255
    end do   ! pio_decomp_frame_tests.F90.in:256
  end do   ! pio_decomp_frame_tests.F90.in:257
   ! pio_decomp_frame_tests.F90.in:258
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:259
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:260
   ! pio_decomp_frame_tests.F90.in:261
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:263
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:264
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:265
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:266
     ! pio_decomp_frame_tests.F90.in:267
  allocate(rbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:268
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:269
  allocate(exp_val(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:270
   ! pio_decomp_frame_tests.F90.in:271
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:272
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:273
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:274
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:275
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:276
          compdof(tmp_idx) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:277
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:278
          exp_val(i,j,k,f) = compdof(tmp_idx) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:279
        end do   ! pio_decomp_frame_tests.F90.in:280
      end do   ! pio_decomp_frame_tests.F90.in:281
    end do   ! pio_decomp_frame_tests.F90.in:282
  end do   ! pio_decomp_frame_tests.F90.in:283
   ! pio_decomp_frame_tests.F90.in:284
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:285
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:286
   ! pio_decomp_frame_tests.F90.in:287
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:288
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:289
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:290
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:291

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:292
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:293
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:294)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:294
   ! pio_decomp_frame_tests.F90.in:295
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:297
   ! pio_decomp_frame_tests.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:300
   ! pio_decomp_frame_tests.F90.in:301
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:303
   ! pio_decomp_frame_tests.F90.in:304
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:306
   ! pio_decomp_frame_tests.F90.in:307
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:309
   ! pio_decomp_frame_tests.F90.in:310
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:312
   ! pio_decomp_frame_tests.F90.in:313
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:314
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:315
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:317
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:318)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:318
    end do   ! pio_decomp_frame_tests.F90.in:319
   ! pio_decomp_frame_tests.F90.in:320
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:322
   ! pio_decomp_frame_tests.F90.in:323
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:325
   ! pio_decomp_frame_tests.F90.in:326
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:328
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:330
#endif
   ! pio_decomp_frame_tests.F90.in:332
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:333
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:334
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:335
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:336)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:336
    end do   ! pio_decomp_frame_tests.F90.in:337
   ! pio_decomp_frame_tests.F90.in:338
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:339
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,:,:,f), exp_val(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:340)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:340
    end do   ! pio_decomp_frame_tests.F90.in:341
   ! pio_decomp_frame_tests.F90.in:342
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:343
       ! pio_decomp_frame_tests.F90.in:344
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:345
  end do   ! pio_decomp_frame_tests.F90.in:346
   ! pio_decomp_frame_tests.F90.in:347
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:348
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:349
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:350
  end if   ! pio_decomp_frame_tests.F90.in:351
   ! pio_decomp_frame_tests.F90.in:352
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:353
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:354
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:355
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:356
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:357
END SUBROUTINE nc_write_read_4d_col_decomp_PIO_int_integer__   ! pio_decomp_frame_tests.F90.in:358


SUBROUTINE nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:216
  implicit none   ! pio_decomp_frame_tests.F90.in:217
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:218
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:219
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:220
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:221
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:222
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:223
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:224
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:225
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:226
  real(kind=fc_real), dimension(:,:,:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:227
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:228
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:229
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:230
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:231
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:233
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:234
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:235
   ! pio_decomp_frame_tests.F90.in:236
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:238
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:239
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:240
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:241
     ! pio_decomp_frame_tests.F90.in:242
  allocate(wbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:243
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:244
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:245
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:246
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:247
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:248
          wbuf(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:249
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:250
          wbuf(i,j,k,f) = wbuf(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:251
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:252
          compdof(tmp_idx) = wbuf(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:253
        end do   ! pio_decomp_frame_tests.F90.in:254
      end do   ! pio_decomp_frame_tests.F90.in:255
    end do   ! pio_decomp_frame_tests.F90.in:256
  end do   ! pio_decomp_frame_tests.F90.in:257
   ! pio_decomp_frame_tests.F90.in:258
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:259
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:260
   ! pio_decomp_frame_tests.F90.in:261
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:263
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:264
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:265
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:266
     ! pio_decomp_frame_tests.F90.in:267
  allocate(rbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:268
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:269
  allocate(exp_val(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:270
   ! pio_decomp_frame_tests.F90.in:271
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:272
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:273
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:274
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:275
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:276
          compdof(tmp_idx) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:277
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:278
          exp_val(i,j,k,f) = compdof(tmp_idx) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:279
        end do   ! pio_decomp_frame_tests.F90.in:280
      end do   ! pio_decomp_frame_tests.F90.in:281
    end do   ! pio_decomp_frame_tests.F90.in:282
  end do   ! pio_decomp_frame_tests.F90.in:283
   ! pio_decomp_frame_tests.F90.in:284
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:285
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:286
   ! pio_decomp_frame_tests.F90.in:287
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:288
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:289
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:290
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:291

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:292
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:293
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:294)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:294
   ! pio_decomp_frame_tests.F90.in:295
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:297
   ! pio_decomp_frame_tests.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:300
   ! pio_decomp_frame_tests.F90.in:301
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:303
   ! pio_decomp_frame_tests.F90.in:304
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:306
   ! pio_decomp_frame_tests.F90.in:307
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:309
   ! pio_decomp_frame_tests.F90.in:310
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:312
   ! pio_decomp_frame_tests.F90.in:313
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:314
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:315
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:317
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:318)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:318
    end do   ! pio_decomp_frame_tests.F90.in:319
   ! pio_decomp_frame_tests.F90.in:320
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:322
   ! pio_decomp_frame_tests.F90.in:323
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:325
   ! pio_decomp_frame_tests.F90.in:326
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:328
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:330
#endif
   ! pio_decomp_frame_tests.F90.in:332
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:333
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:334
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:335
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:336)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:336
    end do   ! pio_decomp_frame_tests.F90.in:337
   ! pio_decomp_frame_tests.F90.in:338
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:339
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,:,:,f), exp_val(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:340)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:340
    end do   ! pio_decomp_frame_tests.F90.in:341
   ! pio_decomp_frame_tests.F90.in:342
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:343
       ! pio_decomp_frame_tests.F90.in:344
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:345
  end do   ! pio_decomp_frame_tests.F90.in:346
   ! pio_decomp_frame_tests.F90.in:347
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:348
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:349
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:350
  end if   ! pio_decomp_frame_tests.F90.in:351
   ! pio_decomp_frame_tests.F90.in:352
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:353
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:354
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:355
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:356
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:357
END SUBROUTINE nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___   ! pio_decomp_frame_tests.F90.in:358


SUBROUTINE nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:216
  implicit none   ! pio_decomp_frame_tests.F90.in:217
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:218
  integer, parameter :: NFRAMES = 6   ! pio_decomp_frame_tests.F90.in:219
  type(var_desc_t)  :: pio_var   ! pio_decomp_frame_tests.F90.in:220
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:221
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:222
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_frame_tests.F90.in:223
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:224
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:225
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:226
  real(kind=fc_double), dimension(:,:,:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_frame_tests.F90.in:227
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:228
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:229
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:230
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:231
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:233
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:234
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:235
   ! pio_decomp_frame_tests.F90.in:236
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:238
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:239
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:240
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:241
     ! pio_decomp_frame_tests.F90.in:242
  allocate(wbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:243
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:244
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:245
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:246
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:247
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:248
          wbuf(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:249
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:250
          wbuf(i,j,k,f) = wbuf(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:251
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:252
          compdof(tmp_idx) = wbuf(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:253
        end do   ! pio_decomp_frame_tests.F90.in:254
      end do   ! pio_decomp_frame_tests.F90.in:255
    end do   ! pio_decomp_frame_tests.F90.in:256
  end do   ! pio_decomp_frame_tests.F90.in:257
   ! pio_decomp_frame_tests.F90.in:258
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:259
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:260
   ! pio_decomp_frame_tests.F90.in:261
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:263
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:264
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:265
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:266
     ! pio_decomp_frame_tests.F90.in:267
  allocate(rbuf(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:268
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:269
  allocate(exp_val(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:270
   ! pio_decomp_frame_tests.F90.in:271
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:272
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:273
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:274
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:275
          tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:276
          compdof(tmp_idx) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:277
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:278
          exp_val(i,j,k,f) = compdof(tmp_idx) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:279
        end do   ! pio_decomp_frame_tests.F90.in:280
      end do   ! pio_decomp_frame_tests.F90.in:281
    end do   ! pio_decomp_frame_tests.F90.in:282
  end do   ! pio_decomp_frame_tests.F90.in:283
   ! pio_decomp_frame_tests.F90.in:284
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:285
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:286
   ! pio_decomp_frame_tests.F90.in:287
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:288
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:289
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:290
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:291

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:292
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:293
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:294)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:294
   ! pio_decomp_frame_tests.F90.in:295
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:297
   ! pio_decomp_frame_tests.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:300
   ! pio_decomp_frame_tests.F90.in:301
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:303
   ! pio_decomp_frame_tests.F90.in:304
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:306
   ! pio_decomp_frame_tests.F90.in:307
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, pio_dims, pio_var)   ! pio_decomp_frame_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:309
   ! pio_decomp_frame_tests.F90.in:310
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:312
   ! pio_decomp_frame_tests.F90.in:313
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:314
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:315
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:317
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:318)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:318
    end do   ! pio_decomp_frame_tests.F90.in:319
   ! pio_decomp_frame_tests.F90.in:320
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:322
   ! pio_decomp_frame_tests.F90.in:323
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:325
   ! pio_decomp_frame_tests.F90.in:326
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_frame_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:328
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:330
#endif
   ! pio_decomp_frame_tests.F90.in:332
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:333
      call PIO_setframe(pio_file, pio_var, f)   ! pio_decomp_frame_tests.F90.in:334
      call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:335
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:336)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:336
    end do   ! pio_decomp_frame_tests.F90.in:337
   ! pio_decomp_frame_tests.F90.in:338
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:339
      
      IF (.NOT. PIO_TF_Check_val_(rbuf(:,:,:,f), exp_val(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:340)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:340
    end do   ! pio_decomp_frame_tests.F90.in:341
   ! pio_decomp_frame_tests.F90.in:342
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:343
       ! pio_decomp_frame_tests.F90.in:344
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:345
  end do   ! pio_decomp_frame_tests.F90.in:346
   ! pio_decomp_frame_tests.F90.in:347
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:348
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:349
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:350
  end if   ! pio_decomp_frame_tests.F90.in:351
   ! pio_decomp_frame_tests.F90.in:352
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:353
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:354
  deallocate(exp_val)   ! pio_decomp_frame_tests.F90.in:355
  deallocate(rbuf)   ! pio_decomp_frame_tests.F90.in:356
  deallocate(wbuf)   ! pio_decomp_frame_tests.F90.in:357
END SUBROUTINE nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___   ! pio_decomp_frame_tests.F90.in:358
   ! pio_decomp_frame_tests.F90.in:358


! Using a 3d decomp for writing out a 3d and a 4d var
! Write with one decomp (to force rearrangement) and read with another (no
! rearrangement)


SUBROUTINE nc_reuse_3d_decomp_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:364
  implicit none   ! pio_decomp_frame_tests.F90.in:365
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:366
  integer, parameter :: NFRAMES = 3   ! pio_decomp_frame_tests.F90.in:367
  type(var_desc_t)  :: pio_var3d, pio_var4d   ! pio_decomp_frame_tests.F90.in:368
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:369
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:370
  character(len=*), parameter :: PIO_3DVAR_NAME = 'PIO_TF_test_3d_var'   ! pio_decomp_frame_tests.F90.in:371
  character(len=*), parameter :: PIO_4DVAR_NAME = 'PIO_TF_test_4d_var'   ! pio_decomp_frame_tests.F90.in:372
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:373
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:374
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:375
  integer, dimension(:,:,:,:), allocatable :: rbuf4d, wbuf4d, exp_val4d   ! pio_decomp_frame_tests.F90.in:376
  integer, dimension(:,:,:), allocatable :: rbuf3d, wbuf3d, exp_val3d   ! pio_decomp_frame_tests.F90.in:377
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:378
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:379
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:380
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:381
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:383
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:384
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:385
   ! pio_decomp_frame_tests.F90.in:386
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:388
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:389
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:390
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:391
     ! pio_decomp_frame_tests.F90.in:392
  ! Initialize the 4d var
  allocate(wbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:394
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:395
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:396
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:397
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:398
          wbuf4d(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:399
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:400
          wbuf4d(i,j,k,f) = wbuf4d(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:401
        end do   ! pio_decomp_frame_tests.F90.in:402
      end do   ! pio_decomp_frame_tests.F90.in:403
    end do   ! pio_decomp_frame_tests.F90.in:404
  end do   ! pio_decomp_frame_tests.F90.in:405
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:406
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:407
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:408
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:409
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:410
        compdof(tmp_idx) = wbuf4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:411
      end do   ! pio_decomp_frame_tests.F90.in:412
    end do   ! pio_decomp_frame_tests.F90.in:413
  end do   ! pio_decomp_frame_tests.F90.in:414
  ! Initialize the 3d var
  allocate(wbuf3d(nrows, ncols, nhgts))    ! pio_decomp_frame_tests.F90.in:416
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:417
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:418
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:419
        wbuf3d(i,j,k) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:420
                      (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:421
      end do   ! pio_decomp_frame_tests.F90.in:422
    end do   ! pio_decomp_frame_tests.F90.in:423
  end do   ! pio_decomp_frame_tests.F90.in:424
   ! pio_decomp_frame_tests.F90.in:425
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:426
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:427
   ! pio_decomp_frame_tests.F90.in:428
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:430
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:431
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:432
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:433
     ! pio_decomp_frame_tests.F90.in:434
  allocate(rbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:435
  rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:436
  ! Expected val for 4d var
  allocate(exp_val4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:438
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:439
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:440
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:441
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:442
          exp_val4d(i,j,k,f) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:443
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:444
          exp_val4d(i,j,k,f) = exp_val4d(i,j,k,f)+(f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:445
        end do   ! pio_decomp_frame_tests.F90.in:446
      end do   ! pio_decomp_frame_tests.F90.in:447
    end do   ! pio_decomp_frame_tests.F90.in:448
  end do   ! pio_decomp_frame_tests.F90.in:449
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:450
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:451
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:452
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:453
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:454
        compdof(tmp_idx) = exp_val4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:455
      end do   ! pio_decomp_frame_tests.F90.in:456
    end do   ! pio_decomp_frame_tests.F90.in:457
  end do   ! pio_decomp_frame_tests.F90.in:458
   ! pio_decomp_frame_tests.F90.in:459
  allocate(rbuf3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:460
  rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:461
  ! Expected val for 3d var
  allocate(exp_val3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:463
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:464
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:465
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:466
        exp_val3d(i,j,k) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:467
                            (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:468
      end do   ! pio_decomp_frame_tests.F90.in:469
    end do   ! pio_decomp_frame_tests.F90.in:470
  end do   ! pio_decomp_frame_tests.F90.in:471
   ! pio_decomp_frame_tests.F90.in:472
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:473
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:474
   ! pio_decomp_frame_tests.F90.in:475
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:476
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:477
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:478
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:479

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:480
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:481
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:482
   ! pio_decomp_frame_tests.F90.in:483
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:484
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:485)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:485
   ! pio_decomp_frame_tests.F90.in:486
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:487
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:488)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:488
   ! pio_decomp_frame_tests.F90.in:489
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:490
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:491)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:491
   ! pio_decomp_frame_tests.F90.in:492
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:493
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:494)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:494
   ! pio_decomp_frame_tests.F90.in:495
    ierr = PIO_def_var(pio_file, PIO_3DVAR_NAME, PIO_int, pio_dims(1:3), pio_var3d)   ! pio_decomp_frame_tests.F90.in:496
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:497)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:497
   ! pio_decomp_frame_tests.F90.in:498
    ierr = PIO_def_var(pio_file, PIO_4DVAR_NAME, PIO_int, pio_dims, pio_var4d)   ! pio_decomp_frame_tests.F90.in:499
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:500)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:500
   ! pio_decomp_frame_tests.F90.in:501
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:502
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:503)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:503
   ! pio_decomp_frame_tests.F90.in:504
    call PIO_write_darray(pio_file, pio_var3d, wr_iodesc, wbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:505
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:506)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:506
   ! pio_decomp_frame_tests.F90.in:507
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:508
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:509
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var4d, wr_iodesc, wbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:511
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:512)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:512
    end do   ! pio_decomp_frame_tests.F90.in:513
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:515
   ! pio_decomp_frame_tests.F90.in:516
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:517
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:518)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:518
   ! pio_decomp_frame_tests.F90.in:519
    ierr = PIO_inq_varid(pio_file, PIO_3DVAR_NAME, pio_var3d)   ! pio_decomp_frame_tests.F90.in:520
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:521)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:521
   ! pio_decomp_frame_tests.F90.in:522
    ierr = PIO_inq_varid(pio_file, PIO_4DVAR_NAME, pio_var4d)   ! pio_decomp_frame_tests.F90.in:523
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:524)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:524
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:526
#endif
   ! pio_decomp_frame_tests.F90.in:528
    rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:529
    rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:530
   ! pio_decomp_frame_tests.F90.in:531
    call PIO_read_darray(pio_file, pio_var3d, rd_iodesc, rbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:532
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:533)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:533
   ! pio_decomp_frame_tests.F90.in:534
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:535
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:536
      call PIO_read_darray(pio_file, pio_var4d, rd_iodesc, rbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:537
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:538)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:538
    end do   ! pio_decomp_frame_tests.F90.in:539
   ! pio_decomp_frame_tests.F90.in:540
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:541
      
      IF (.NOT. PIO_TF_Check_val_(rbuf4d(:,:,:,f), exp_val4d(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong 4d val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:542)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:542
    end do   ! pio_decomp_frame_tests.F90.in:543
    
    IF (.NOT. PIO_TF_Check_val_(rbuf3d, exp_val3d)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong 3dd val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:544)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:544
   ! pio_decomp_frame_tests.F90.in:545
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:546
       ! pio_decomp_frame_tests.F90.in:547
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:548
  end do   ! pio_decomp_frame_tests.F90.in:549
   ! pio_decomp_frame_tests.F90.in:550
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:551
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:552
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:553
  end if   ! pio_decomp_frame_tests.F90.in:554
   ! pio_decomp_frame_tests.F90.in:555
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:556
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:557
   ! pio_decomp_frame_tests.F90.in:558
  deallocate(exp_val3d)   ! pio_decomp_frame_tests.F90.in:559
  deallocate(rbuf3d)   ! pio_decomp_frame_tests.F90.in:560
  deallocate(wbuf3d)   ! pio_decomp_frame_tests.F90.in:561
   ! pio_decomp_frame_tests.F90.in:562
  deallocate(exp_val4d)   ! pio_decomp_frame_tests.F90.in:563
  deallocate(rbuf4d)   ! pio_decomp_frame_tests.F90.in:564
  deallocate(wbuf4d)   ! pio_decomp_frame_tests.F90.in:565
END SUBROUTINE nc_reuse_3d_decomp_PIO_int_integer__   ! pio_decomp_frame_tests.F90.in:566


SUBROUTINE nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:364
  implicit none   ! pio_decomp_frame_tests.F90.in:365
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:366
  integer, parameter :: NFRAMES = 3   ! pio_decomp_frame_tests.F90.in:367
  type(var_desc_t)  :: pio_var3d, pio_var4d   ! pio_decomp_frame_tests.F90.in:368
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:369
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:370
  character(len=*), parameter :: PIO_3DVAR_NAME = 'PIO_TF_test_3d_var'   ! pio_decomp_frame_tests.F90.in:371
  character(len=*), parameter :: PIO_4DVAR_NAME = 'PIO_TF_test_4d_var'   ! pio_decomp_frame_tests.F90.in:372
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:373
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:374
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:375
  real(kind=fc_real), dimension(:,:,:,:), allocatable :: rbuf4d, wbuf4d, exp_val4d   ! pio_decomp_frame_tests.F90.in:376
  real(kind=fc_real), dimension(:,:,:), allocatable :: rbuf3d, wbuf3d, exp_val3d   ! pio_decomp_frame_tests.F90.in:377
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:378
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:379
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:380
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:381
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:383
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:384
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:385
   ! pio_decomp_frame_tests.F90.in:386
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:388
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:389
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:390
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:391
     ! pio_decomp_frame_tests.F90.in:392
  ! Initialize the 4d var
  allocate(wbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:394
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:395
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:396
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:397
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:398
          wbuf4d(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:399
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:400
          wbuf4d(i,j,k,f) = wbuf4d(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:401
        end do   ! pio_decomp_frame_tests.F90.in:402
      end do   ! pio_decomp_frame_tests.F90.in:403
    end do   ! pio_decomp_frame_tests.F90.in:404
  end do   ! pio_decomp_frame_tests.F90.in:405
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:406
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:407
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:408
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:409
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:410
        compdof(tmp_idx) = wbuf4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:411
      end do   ! pio_decomp_frame_tests.F90.in:412
    end do   ! pio_decomp_frame_tests.F90.in:413
  end do   ! pio_decomp_frame_tests.F90.in:414
  ! Initialize the 3d var
  allocate(wbuf3d(nrows, ncols, nhgts))    ! pio_decomp_frame_tests.F90.in:416
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:417
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:418
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:419
        wbuf3d(i,j,k) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:420
                      (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:421
      end do   ! pio_decomp_frame_tests.F90.in:422
    end do   ! pio_decomp_frame_tests.F90.in:423
  end do   ! pio_decomp_frame_tests.F90.in:424
   ! pio_decomp_frame_tests.F90.in:425
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:426
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:427
   ! pio_decomp_frame_tests.F90.in:428
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:430
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:431
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:432
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:433
     ! pio_decomp_frame_tests.F90.in:434
  allocate(rbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:435
  rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:436
  ! Expected val for 4d var
  allocate(exp_val4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:438
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:439
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:440
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:441
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:442
          exp_val4d(i,j,k,f) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:443
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:444
          exp_val4d(i,j,k,f) = exp_val4d(i,j,k,f)+(f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:445
        end do   ! pio_decomp_frame_tests.F90.in:446
      end do   ! pio_decomp_frame_tests.F90.in:447
    end do   ! pio_decomp_frame_tests.F90.in:448
  end do   ! pio_decomp_frame_tests.F90.in:449
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:450
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:451
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:452
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:453
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:454
        compdof(tmp_idx) = exp_val4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:455
      end do   ! pio_decomp_frame_tests.F90.in:456
    end do   ! pio_decomp_frame_tests.F90.in:457
  end do   ! pio_decomp_frame_tests.F90.in:458
   ! pio_decomp_frame_tests.F90.in:459
  allocate(rbuf3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:460
  rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:461
  ! Expected val for 3d var
  allocate(exp_val3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:463
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:464
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:465
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:466
        exp_val3d(i,j,k) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:467
                            (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:468
      end do   ! pio_decomp_frame_tests.F90.in:469
    end do   ! pio_decomp_frame_tests.F90.in:470
  end do   ! pio_decomp_frame_tests.F90.in:471
   ! pio_decomp_frame_tests.F90.in:472
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:473
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:474
   ! pio_decomp_frame_tests.F90.in:475
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:476
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:477
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:478
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:479

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:480
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:481
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:482
   ! pio_decomp_frame_tests.F90.in:483
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:484
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:485)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:485
   ! pio_decomp_frame_tests.F90.in:486
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:487
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:488)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:488
   ! pio_decomp_frame_tests.F90.in:489
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:490
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:491)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:491
   ! pio_decomp_frame_tests.F90.in:492
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:493
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:494)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:494
   ! pio_decomp_frame_tests.F90.in:495
    ierr = PIO_def_var(pio_file, PIO_3DVAR_NAME, PIO_real, pio_dims(1:3), pio_var3d)   ! pio_decomp_frame_tests.F90.in:496
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:497)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:497
   ! pio_decomp_frame_tests.F90.in:498
    ierr = PIO_def_var(pio_file, PIO_4DVAR_NAME, PIO_real, pio_dims, pio_var4d)   ! pio_decomp_frame_tests.F90.in:499
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:500)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:500
   ! pio_decomp_frame_tests.F90.in:501
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:502
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:503)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:503
   ! pio_decomp_frame_tests.F90.in:504
    call PIO_write_darray(pio_file, pio_var3d, wr_iodesc, wbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:505
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:506)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:506
   ! pio_decomp_frame_tests.F90.in:507
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:508
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:509
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var4d, wr_iodesc, wbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:511
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:512)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:512
    end do   ! pio_decomp_frame_tests.F90.in:513
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:515
   ! pio_decomp_frame_tests.F90.in:516
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:517
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:518)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:518
   ! pio_decomp_frame_tests.F90.in:519
    ierr = PIO_inq_varid(pio_file, PIO_3DVAR_NAME, pio_var3d)   ! pio_decomp_frame_tests.F90.in:520
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:521)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:521
   ! pio_decomp_frame_tests.F90.in:522
    ierr = PIO_inq_varid(pio_file, PIO_4DVAR_NAME, pio_var4d)   ! pio_decomp_frame_tests.F90.in:523
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:524)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:524
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:526
#endif
   ! pio_decomp_frame_tests.F90.in:528
    rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:529
    rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:530
   ! pio_decomp_frame_tests.F90.in:531
    call PIO_read_darray(pio_file, pio_var3d, rd_iodesc, rbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:532
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:533)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:533
   ! pio_decomp_frame_tests.F90.in:534
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:535
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:536
      call PIO_read_darray(pio_file, pio_var4d, rd_iodesc, rbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:537
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:538)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:538
    end do   ! pio_decomp_frame_tests.F90.in:539
   ! pio_decomp_frame_tests.F90.in:540
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:541
      
      IF (.NOT. PIO_TF_Check_val_(rbuf4d(:,:,:,f), exp_val4d(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong 4d val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:542)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:542
    end do   ! pio_decomp_frame_tests.F90.in:543
    
    IF (.NOT. PIO_TF_Check_val_(rbuf3d, exp_val3d)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong 3dd val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:544)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:544
   ! pio_decomp_frame_tests.F90.in:545
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:546
       ! pio_decomp_frame_tests.F90.in:547
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:548
  end do   ! pio_decomp_frame_tests.F90.in:549
   ! pio_decomp_frame_tests.F90.in:550
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:551
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:552
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:553
  end if   ! pio_decomp_frame_tests.F90.in:554
   ! pio_decomp_frame_tests.F90.in:555
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:556
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:557
   ! pio_decomp_frame_tests.F90.in:558
  deallocate(exp_val3d)   ! pio_decomp_frame_tests.F90.in:559
  deallocate(rbuf3d)   ! pio_decomp_frame_tests.F90.in:560
  deallocate(wbuf3d)   ! pio_decomp_frame_tests.F90.in:561
   ! pio_decomp_frame_tests.F90.in:562
  deallocate(exp_val4d)   ! pio_decomp_frame_tests.F90.in:563
  deallocate(rbuf4d)   ! pio_decomp_frame_tests.F90.in:564
  deallocate(wbuf4d)   ! pio_decomp_frame_tests.F90.in:565
END SUBROUTINE nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___   ! pio_decomp_frame_tests.F90.in:566


SUBROUTINE nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_frame_tests.F90.in:364
  implicit none   ! pio_decomp_frame_tests.F90.in:365
  integer, parameter :: NDIMS = 4   ! pio_decomp_frame_tests.F90.in:366
  integer, parameter :: NFRAMES = 3   ! pio_decomp_frame_tests.F90.in:367
  type(var_desc_t)  :: pio_var3d, pio_var4d   ! pio_decomp_frame_tests.F90.in:368
  type(file_desc_t) :: pio_file   ! pio_decomp_frame_tests.F90.in:369
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_frame_tests.F90.in:370
  character(len=*), parameter :: PIO_3DVAR_NAME = 'PIO_TF_test_3d_var'   ! pio_decomp_frame_tests.F90.in:371
  character(len=*), parameter :: PIO_4DVAR_NAME = 'PIO_TF_test_4d_var'   ! pio_decomp_frame_tests.F90.in:372
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_frame_tests.F90.in:373
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_frame_tests.F90.in:374
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_frame_tests.F90.in:375
  real(kind=fc_double), dimension(:,:,:,:), allocatable :: rbuf4d, wbuf4d, exp_val4d   ! pio_decomp_frame_tests.F90.in:376
  real(kind=fc_double), dimension(:,:,:), allocatable :: rbuf3d, wbuf3d, exp_val3d   ! pio_decomp_frame_tests.F90.in:377
  integer, dimension(NDIMS-1) :: dims   ! pio_decomp_frame_tests.F90.in:378
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_frame_tests.F90.in:379
  integer :: i, j, k, tmp_idx, ierr, lsz, nrows, ncols, nhgts   ! pio_decomp_frame_tests.F90.in:380
  integer(kind=pio_offset_kind) :: f   ! pio_decomp_frame_tests.F90.in:381
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_frame_tests.F90.in:383
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_frame_tests.F90.in:384
  integer :: num_iotypes   ! pio_decomp_frame_tests.F90.in:385
   ! pio_decomp_frame_tests.F90.in:386
  ! Set the decomposition for writing data - forcing rearrangement
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_frame_tests.F90.in:388
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:389
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:390
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:391
     ! pio_decomp_frame_tests.F90.in:392
  ! Initialize the 4d var
  allocate(wbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:394
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:395
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:396
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:397
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:398
          wbuf4d(i,j,k,f) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:399
                        (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:400
          wbuf4d(i,j,k,f) = wbuf4d(i,j,k,f) + (f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:401
        end do   ! pio_decomp_frame_tests.F90.in:402
      end do   ! pio_decomp_frame_tests.F90.in:403
    end do   ! pio_decomp_frame_tests.F90.in:404
  end do   ! pio_decomp_frame_tests.F90.in:405
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:406
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:407
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:408
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:409
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:410
        compdof(tmp_idx) = wbuf4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:411
      end do   ! pio_decomp_frame_tests.F90.in:412
    end do   ! pio_decomp_frame_tests.F90.in:413
  end do   ! pio_decomp_frame_tests.F90.in:414
  ! Initialize the 3d var
  allocate(wbuf3d(nrows, ncols, nhgts))    ! pio_decomp_frame_tests.F90.in:416
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:417
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:418
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:419
        wbuf3d(i,j,k) = (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:420
                      (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:421
      end do   ! pio_decomp_frame_tests.F90.in:422
    end do   ! pio_decomp_frame_tests.F90.in:423
  end do   ! pio_decomp_frame_tests.F90.in:424
   ! pio_decomp_frame_tests.F90.in:425
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:426
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:427
   ! pio_decomp_frame_tests.F90.in:428
  ! Set the decomposition for reading data - different from the write decomp
  call get_3d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_frame_tests.F90.in:430
  nrows = count(1)   ! pio_decomp_frame_tests.F90.in:431
  ncols = count(2)   ! pio_decomp_frame_tests.F90.in:432
  nhgts = count(3)   ! pio_decomp_frame_tests.F90.in:433
     ! pio_decomp_frame_tests.F90.in:434
  allocate(rbuf4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:435
  rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:436
  ! Expected val for 4d var
  allocate(exp_val4d(nrows, ncols, nhgts, NFRAMES))   ! pio_decomp_frame_tests.F90.in:438
  do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:439
    do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:440
      do j=1,ncols   ! pio_decomp_frame_tests.F90.in:441
        do i=1,nrows   ! pio_decomp_frame_tests.F90.in:442
          exp_val4d(i,j,k,f) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:443
                              (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:444
          exp_val4d(i,j,k,f) = exp_val4d(i,j,k,f)+(f - 1) * (dims(1) * dims(2) * dims(3))   ! pio_decomp_frame_tests.F90.in:445
        end do   ! pio_decomp_frame_tests.F90.in:446
      end do   ! pio_decomp_frame_tests.F90.in:447
    end do   ! pio_decomp_frame_tests.F90.in:448
  end do   ! pio_decomp_frame_tests.F90.in:449
  allocate(compdof(nrows * ncols * nhgts))   ! pio_decomp_frame_tests.F90.in:450
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:451
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:452
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:453
        tmp_idx = (k - 1) * (ncols * nrows) + (j - 1) * nrows + i   ! pio_decomp_frame_tests.F90.in:454
        compdof(tmp_idx) = exp_val4d(i,j,k,1)   ! pio_decomp_frame_tests.F90.in:455
      end do   ! pio_decomp_frame_tests.F90.in:456
    end do   ! pio_decomp_frame_tests.F90.in:457
  end do   ! pio_decomp_frame_tests.F90.in:458
   ! pio_decomp_frame_tests.F90.in:459
  allocate(rbuf3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:460
  rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:461
  ! Expected val for 3d var
  allocate(exp_val3d(nrows, ncols, nhgts))   ! pio_decomp_frame_tests.F90.in:463
  do k=1,nhgts   ! pio_decomp_frame_tests.F90.in:464
    do j=1,ncols   ! pio_decomp_frame_tests.F90.in:465
      do i=1,nrows   ! pio_decomp_frame_tests.F90.in:466
        exp_val3d(i,j,k) =  (start(3) - 1 + k - 1) * (dims(1) * dims(2)) +&   ! pio_decomp_frame_tests.F90.in:467
                            (start(2) - 1 + j - 1) * dims(1) + i   ! pio_decomp_frame_tests.F90.in:468
      end do   ! pio_decomp_frame_tests.F90.in:469
    end do   ! pio_decomp_frame_tests.F90.in:470
  end do   ! pio_decomp_frame_tests.F90.in:471
   ! pio_decomp_frame_tests.F90.in:472
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:473
  deallocate(compdof)   ! pio_decomp_frame_tests.F90.in:474
   ! pio_decomp_frame_tests.F90.in:475
  num_iotypes = 0   ! pio_decomp_frame_tests.F90.in:476
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_frame_tests.F90.in:477
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_frame_tests.F90.in:478
  do i=1,num_iotypes   ! pio_decomp_frame_tests.F90.in:479

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_frame_tests.F90.in:480
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_frame_tests.F90.in:481
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:482
   ! pio_decomp_frame_tests.F90.in:483
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_frame_tests.F90.in:484
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:485)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:485
   ! pio_decomp_frame_tests.F90.in:486
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_frame_tests.F90.in:487
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:488)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:488
   ! pio_decomp_frame_tests.F90.in:489
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_hgt', dims(3), pio_dims(3))   ! pio_decomp_frame_tests.F90.in:490
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:491)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:491
   ! pio_decomp_frame_tests.F90.in:492
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_time', pio_unlimited, pio_dims(4))   ! pio_decomp_frame_tests.F90.in:493
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:494)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:494
   ! pio_decomp_frame_tests.F90.in:495
    ierr = PIO_def_var(pio_file, PIO_3DVAR_NAME, PIO_double, pio_dims(1:3), pio_var3d)   ! pio_decomp_frame_tests.F90.in:496
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:497)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:497
   ! pio_decomp_frame_tests.F90.in:498
    ierr = PIO_def_var(pio_file, PIO_4DVAR_NAME, PIO_double, pio_dims, pio_var4d)   ! pio_decomp_frame_tests.F90.in:499
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:500)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:500
   ! pio_decomp_frame_tests.F90.in:501
    ierr = PIO_enddef(pio_file)   ! pio_decomp_frame_tests.F90.in:502
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:503)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:503
   ! pio_decomp_frame_tests.F90.in:504
    call PIO_write_darray(pio_file, pio_var3d, wr_iodesc, wbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:505
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:506)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:506
   ! pio_decomp_frame_tests.F90.in:507
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:508
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:509
      ! Write the current frame
      call PIO_write_darray(pio_file, pio_var4d, wr_iodesc, wbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:511
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to write 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:512)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:512
    end do   ! pio_decomp_frame_tests.F90.in:513
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:515
   ! pio_decomp_frame_tests.F90.in:516
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_frame_tests.F90.in:517
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:518)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:518
   ! pio_decomp_frame_tests.F90.in:519
    ierr = PIO_inq_varid(pio_file, PIO_3DVAR_NAME, pio_var3d)   ! pio_decomp_frame_tests.F90.in:520
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 3d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:521)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:521
   ! pio_decomp_frame_tests.F90.in:522
    ierr = PIO_inq_varid(pio_file, PIO_4DVAR_NAME, pio_var4d)   ! pio_decomp_frame_tests.F90.in:523
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq 4d var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:524)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:524
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_frame_tests.F90.in:526
#endif
   ! pio_decomp_frame_tests.F90.in:528
    rbuf4d = 0   ! pio_decomp_frame_tests.F90.in:529
    rbuf3d = 0   ! pio_decomp_frame_tests.F90.in:530
   ! pio_decomp_frame_tests.F90.in:531
    call PIO_read_darray(pio_file, pio_var3d, rd_iodesc, rbuf3d, ierr)   ! pio_decomp_frame_tests.F90.in:532
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read 3d darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:533)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:533
   ! pio_decomp_frame_tests.F90.in:534
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:535
      call PIO_setframe(pio_file, pio_var4d, f)   ! pio_decomp_frame_tests.F90.in:536
      call PIO_read_darray(pio_file, pio_var4d, rd_iodesc, rbuf4d(:,:,:,f), ierr)   ! pio_decomp_frame_tests.F90.in:537
      
      IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Function failed:",&
             "Failed to read 4d darray : " // trim(filename),&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:538)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:538
    end do   ! pio_decomp_frame_tests.F90.in:539
   ! pio_decomp_frame_tests.F90.in:540
    do f=1,NFRAMES   ! pio_decomp_frame_tests.F90.in:541
      
      IF (.NOT. PIO_TF_Check_val_(rbuf4d(:,:,:,f), exp_val4d(:,:,:,f))) THEN
        pio_tf_retval_utest_ = -1
        IF (pio_tf_world_rank_ == 0) THEN
          PRINT *, "PIO_TF: PIO Check failed:",&
             "Got wrong 4d val, frame=", f,&
            ":", __FILE__, ":", __LINE__,&
            "(pio_decomp_frame_tests.F90.in:542)"
        END IF
        RETURN
      END IF   ! pio_decomp_frame_tests.F90.in:542
    end do   ! pio_decomp_frame_tests.F90.in:543
    
    IF (.NOT. PIO_TF_Check_val_(rbuf3d, exp_val3d)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong 3dd val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_frame_tests.F90.in:544)"
      END IF
      RETURN
    END IF   ! pio_decomp_frame_tests.F90.in:544
   ! pio_decomp_frame_tests.F90.in:545
    call PIO_closefile(pio_file)   ! pio_decomp_frame_tests.F90.in:546
       ! pio_decomp_frame_tests.F90.in:547
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_frame_tests.F90.in:548
  end do   ! pio_decomp_frame_tests.F90.in:549
   ! pio_decomp_frame_tests.F90.in:550
  if(allocated(iotypes)) then   ! pio_decomp_frame_tests.F90.in:551
    deallocate(iotypes)   ! pio_decomp_frame_tests.F90.in:552
    deallocate(iotype_descs)   ! pio_decomp_frame_tests.F90.in:553
  end if   ! pio_decomp_frame_tests.F90.in:554
   ! pio_decomp_frame_tests.F90.in:555
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_frame_tests.F90.in:556
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_frame_tests.F90.in:557
   ! pio_decomp_frame_tests.F90.in:558
  deallocate(exp_val3d)   ! pio_decomp_frame_tests.F90.in:559
  deallocate(rbuf3d)   ! pio_decomp_frame_tests.F90.in:560
  deallocate(wbuf3d)   ! pio_decomp_frame_tests.F90.in:561
   ! pio_decomp_frame_tests.F90.in:562
  deallocate(exp_val4d)   ! pio_decomp_frame_tests.F90.in:563
  deallocate(rbuf4d)   ! pio_decomp_frame_tests.F90.in:564
  deallocate(wbuf4d)   ! pio_decomp_frame_tests.F90.in:565
END SUBROUTINE nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___   ! pio_decomp_frame_tests.F90.in:566
   ! pio_decomp_frame_tests.F90.in:566


  SUBROUTINE PIO_TF_Test_driver_
    USE pio_tutil
    IMPLICIT NONE
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_int_integer__"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_int_integer__"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_int_integer__"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_write_read_4d_col_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_write_read_4d_col_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_int_integer__"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 10:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 10:",&
          "nc_wr_rd_2d_unlim_dim_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 11:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 11:",&
          "nc_wr_rd_2d_unlim_dim_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 12:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 12:",&
          "nc_wr_rd_2d_unlim_dim_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_int_integer__"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 13:",&
          "nc_write_read_4d_col_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 13:",&
          "nc_write_read_4d_col_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 14:",&
          "nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 14:",&
          "nc_write_read_4d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 15:",&
          "nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 15:",&
          "nc_write_read_4d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_reuse_3d_decomp_PIO_int_integer__"
    END IF
    CALL nc_reuse_3d_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 16:",&
          "nc_reuse_3d_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 16:",&
          "nc_reuse_3d_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 17:",&
          "nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 17:",&
          "nc_reuse_3d_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 18:",&
          "nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 18:",&
          "nc_reuse_3d_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
  END SUBROUTINE PIO_TF_Test_driver_


  PROGRAM PIO_TF_Test_main_
    USE pio_tutil
    IMPLICIT NONE
    INTEGER, PARAMETER :: NREARRS = 2
    INTEGER :: rearrs(NREARRS) = (/pio_rearr_subset,pio_rearr_box/)
    CHARACTER(LEN=PIO_TF_MAX_STR_LEN) :: rearrs_info(NREARRS) = (/"PIO_REARR_SUBSET","PIO_REARR_BOX   "/)
    INTEGER i, ierr

    pio_tf_nerrs_total_=0
    pio_tf_retval_utest_=0
    CALL MPI_Init(ierr)
    DO i=1,SIZE(rearrs)
      CALL PIO_TF_Init_(rearrs(i))
      IF (pio_tf_world_rank_ == 0) THEN
        WRITE(*,*) "PIO_TF: Testing : ", trim(rearrs_info(i))
      END IF
      CALL PIO_TF_Test_driver_()
      CALL PIO_TF_Finalize_()
    END DO
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_nerrs_total_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "All tests", "---------", "PASSED"
        ELSE
          pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "Test driver", "---------", "FAILED"
        END IF
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT2) "PIO_TF:[",&
          pio_tf_nerrs_total_,"] Tests",&
          "----- FAILED"
      END IF
    END IF
    CALL MPI_Finalize(ierr)
    IF (pio_tf_nerrs_total_ /= 0) THEN
      STOP 99
    END IF
  END PROGRAM
