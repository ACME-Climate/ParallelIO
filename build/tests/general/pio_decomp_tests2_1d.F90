! DON'T MODIFY THIS FILE, ALL YOUR CHANGES WILL BE LOST
! This file is generated by ../../../tests/general/util/pio_tf_f90gen.pl
! from /home/tkurc/codar/e3sm/pio_adios1/ParallelIO/tests/general/pio_decomp_tests2_1d.F90.in

! Get a decomposition such that each process has to perform
! an alltoall (communicate with all processes including itself)
! communication to write data out.
! If force_all2all is FALSE, the decomposition is such that
! NPROCS * (NPROCS * VEC_BLOCK_SZ) elements are evenly distributed
! across all processes
! # All procs have NPROCS * VEC_BLOCK_SZ elements
! e.g. For NPROCS = 3, VEC_BLOCK_SZ = 1,
!       [1,2,3] [4,5,6] [7,8,9]
! e.g. For NPROCS = 3, VEC_BLOCK_SZ = 2,
!       [1,2,3,4,5,6] [7,8,9,10,11,12] [13,14,15,16,17,18]
! If force_all2all is TRUE, the decomposition is such that,
! each process reads/writes elements in
! [rank*VEC_BLOCK_SZ + 1, rank*VEC_BLOCK_SZ + VEC_BLOCK_SZ] from
! each process in the decomposition with the force_all2all set to 
! FALSE
! # All procs have NPROCS * VEC_BLOCK_SZ elements
! e.g. For NPROCS = 3, VEC_BLOCK_SZ = 1,
!       [1,4,7] [2,5,8] [3,6,9]
! e.g. For NPROCS = 3, VEC_BLOCK_SZ = 2,
!       [1,2,7,8,13,14] [3,4,9,10,15,16] [5,6,11,12,17,18]
SUBROUTINE get_1d_a2a_info(rank, sz, dims, start, count, force_all2all)   ! pio_decomp_tests2_1d.F90.in:22
  integer, parameter :: VEC_BLOCK_SZ = 7   ! pio_decomp_tests2_1d.F90.in:23
  integer, intent(in) :: rank   ! pio_decomp_tests2_1d.F90.in:24
  integer, intent(in) :: sz   ! pio_decomp_tests2_1d.F90.in:25
  integer, dimension(1), intent(out) :: dims   ! pio_decomp_tests2_1d.F90.in:26
  integer, dimension(:), allocatable, intent(out) :: start   ! pio_decomp_tests2_1d.F90.in:27
  integer, dimension(:), allocatable, intent(out) :: count   ! pio_decomp_tests2_1d.F90.in:28
  logical, intent(in) :: force_all2all   ! pio_decomp_tests2_1d.F90.in:29


  integer :: i   ! pio_decomp_tests2_1d.F90.in:31
  integer :: lsz   ! pio_decomp_tests2_1d.F90.in:32


  ! Number of elemeents in local process
  lsz = sz * VEC_BLOCK_SZ   ! pio_decomp_tests2_1d.F90.in:35


  ! Global dimension size
  dims(1) = lsz * sz   ! pio_decomp_tests2_1d.F90.in:38


  ! Compute start/count
  if(force_all2all) then   ! pio_decomp_tests2_1d.F90.in:41
    ! Local elements belong to multiple contiguous regions
    ! : sz regions, each region of size VEC_BLOCK_SZ
    allocate(start(sz))   ! pio_decomp_tests2_1d.F90.in:44
    allocate(count(sz))   ! pio_decomp_tests2_1d.F90.in:45


    start=1   ! pio_decomp_tests2_1d.F90.in:47
    count=0   ! pio_decomp_tests2_1d.F90.in:48


    do i=1,sz   ! pio_decomp_tests2_1d.F90.in:50
      start(i) = (rank * VEC_BLOCK_SZ + 1) + (i - 1) * lsz   ! pio_decomp_tests2_1d.F90.in:51
      count(i) = VEC_BLOCK_SZ   ! pio_decomp_tests2_1d.F90.in:52
    end do   ! pio_decomp_tests2_1d.F90.in:53
  else   ! pio_decomp_tests2_1d.F90.in:54
    ! Evenly distribute elements across all procs
    ! Local elements belong to a single contiguous region
    allocate(start(1))   ! pio_decomp_tests2_1d.F90.in:57
    allocate(count(1))   ! pio_decomp_tests2_1d.F90.in:58


    start(1) = rank * lsz + 1   ! pio_decomp_tests2_1d.F90.in:60
    count(1) = lsz   ! pio_decomp_tests2_1d.F90.in:61
  end if   ! pio_decomp_tests2_1d.F90.in:62


END SUBROUTINE   ! pio_decomp_tests2_1d.F90.in:64


! Get 1d block cycle decomposition
SUBROUTINE get_1d_bc_info(rank, sz, dims, start, count)   ! pio_decomp_tests2_1d.F90.in:67
  integer, parameter :: VEC_BLOCK_SZ = 7   ! pio_decomp_tests2_1d.F90.in:68
  integer, intent(in) :: rank   ! pio_decomp_tests2_1d.F90.in:69
  integer, intent(in) :: sz   ! pio_decomp_tests2_1d.F90.in:70
  integer, dimension(1), intent(out) :: dims   ! pio_decomp_tests2_1d.F90.in:71
  integer, dimension(1), intent(out) :: start   ! pio_decomp_tests2_1d.F90.in:72
  integer, dimension(1), intent(out) :: count   ! pio_decomp_tests2_1d.F90.in:73


  integer :: lsz   ! pio_decomp_tests2_1d.F90.in:75


  ! Number of elemeents in local process
  lsz = sz * VEC_BLOCK_SZ   ! pio_decomp_tests2_1d.F90.in:78


  ! Global dimension size
  dims(1) = lsz * sz   ! pio_decomp_tests2_1d.F90.in:81


  ! Evenly distribute elements across all procs
  ! Local elements belong to a single contiguous region
  start(1) = rank * lsz + 1   ! pio_decomp_tests2_1d.F90.in:85
  count(1) = lsz   ! pio_decomp_tests2_1d.F90.in:86


END SUBROUTINE   ! pio_decomp_tests2_1d.F90.in:88


! Write (and read back) data with a decomposition that forces
! alltoall communication between the MPI processes


SUBROUTINE nc_wr_rd_a2a_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:93
  implicit none   ! pio_decomp_tests2_1d.F90.in:94
  INTERFACE   ! pio_decomp_tests2_1d.F90.in:95
    SUBROUTINE get_1d_a2a_info(rank, sz, dims, start, count, force_all2all)   ! pio_decomp_tests2_1d.F90.in:96
      integer, intent(in) :: rank   ! pio_decomp_tests2_1d.F90.in:97
      integer, intent(in) :: sz   ! pio_decomp_tests2_1d.F90.in:98
      integer, dimension(1), intent(out) :: dims   ! pio_decomp_tests2_1d.F90.in:99
      integer, dimension(:), allocatable, intent(out) :: start   ! pio_decomp_tests2_1d.F90.in:100
      integer, dimension(:), allocatable, intent(out) :: count   ! pio_decomp_tests2_1d.F90.in:101
      logical, intent(in) :: force_all2all   ! pio_decomp_tests2_1d.F90.in:102
    END SUBROUTINE get_1d_a2a_info   ! pio_decomp_tests2_1d.F90.in:103
  END INTERFACE   ! pio_decomp_tests2_1d.F90.in:104
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:105
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:106
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:107
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:108
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:109
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:110
  integer, dimension(:), allocatable :: start, count   ! pio_decomp_tests2_1d.F90.in:111
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:112
  integer, dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:113
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:114
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:115
  integer :: i, j, k, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:116
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:118
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:119
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:120
   ! pio_decomp_tests2_1d.F90.in:121
  ! Set the decomposition for writing data
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests2_1d.F90.in:123
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:124)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:124
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:125)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:125
   ! pio_decomp_tests2_1d.F90.in:126
  tot_count = 0   ! pio_decomp_tests2_1d.F90.in:127
  do i=1,size(count)   ! pio_decomp_tests2_1d.F90.in:128
    tot_count = tot_count + count(i)    ! pio_decomp_tests2_1d.F90.in:129
  end do   ! pio_decomp_tests2_1d.F90.in:130
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:131
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:132
  k = 1   ! pio_decomp_tests2_1d.F90.in:133
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:134
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:135
      wbuf(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:136
      compdof(k) = wbuf(k)   ! pio_decomp_tests2_1d.F90.in:137
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:138
    end do   ! pio_decomp_tests2_1d.F90.in:139
  end do   ! pio_decomp_tests2_1d.F90.in:140
   ! pio_decomp_tests2_1d.F90.in:141
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:142
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:143
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:144
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:145
   ! pio_decomp_tests2_1d.F90.in:146
  ! Set the decomposition for reading data
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:148
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:149
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:150
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests2_1d.F90.in:151
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:152)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:152
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:153)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:153
   ! pio_decomp_tests2_1d.F90.in:154
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:155
  k = 1   ! pio_decomp_tests2_1d.F90.in:156
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:157
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:158
      exp_val(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:159
      compdof(k) = exp_val(k)   ! pio_decomp_tests2_1d.F90.in:160
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:161
    end do   ! pio_decomp_tests2_1d.F90.in:162
  end do   ! pio_decomp_tests2_1d.F90.in:163
   ! pio_decomp_tests2_1d.F90.in:164
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:165
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:166
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:167
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:168
   ! pio_decomp_tests2_1d.F90.in:169
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:171
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:172
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:173
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:174

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:175
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:176
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:177)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:177
   ! pio_decomp_tests2_1d.F90.in:178
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:179
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:180)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:180
   ! pio_decomp_tests2_1d.F90.in:181
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:182
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:183)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:183
   ! pio_decomp_tests2_1d.F90.in:184
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:185
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:186)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:186
   ! pio_decomp_tests2_1d.F90.in:187
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:189
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:190)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:190
   ! pio_decomp_tests2_1d.F90.in:191
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:193
   ! pio_decomp_tests2_1d.F90.in:194
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:195
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:196)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:196
   ! pio_decomp_tests2_1d.F90.in:197
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:199
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:201
#endif
   ! pio_decomp_tests2_1d.F90.in:203
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:204
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:205)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:205
   ! pio_decomp_tests2_1d.F90.in:206
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:207)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:207
   ! pio_decomp_tests2_1d.F90.in:208
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:209
       ! pio_decomp_tests2_1d.F90.in:210
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:211
  end do   ! pio_decomp_tests2_1d.F90.in:212
   ! pio_decomp_tests2_1d.F90.in:213
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:214
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:215
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:216
  end if   ! pio_decomp_tests2_1d.F90.in:217
   ! pio_decomp_tests2_1d.F90.in:218
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:219
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:220
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:221
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:222
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:223
END SUBROUTINE nc_wr_rd_a2a_PIO_int_integer__   ! pio_decomp_tests2_1d.F90.in:224


SUBROUTINE nc_wr_rd_a2a_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:93
  implicit none   ! pio_decomp_tests2_1d.F90.in:94
  INTERFACE   ! pio_decomp_tests2_1d.F90.in:95
    SUBROUTINE get_1d_a2a_info(rank, sz, dims, start, count, force_all2all)   ! pio_decomp_tests2_1d.F90.in:96
      integer, intent(in) :: rank   ! pio_decomp_tests2_1d.F90.in:97
      integer, intent(in) :: sz   ! pio_decomp_tests2_1d.F90.in:98
      integer, dimension(1), intent(out) :: dims   ! pio_decomp_tests2_1d.F90.in:99
      integer, dimension(:), allocatable, intent(out) :: start   ! pio_decomp_tests2_1d.F90.in:100
      integer, dimension(:), allocatable, intent(out) :: count   ! pio_decomp_tests2_1d.F90.in:101
      logical, intent(in) :: force_all2all   ! pio_decomp_tests2_1d.F90.in:102
    END SUBROUTINE get_1d_a2a_info   ! pio_decomp_tests2_1d.F90.in:103
  END INTERFACE   ! pio_decomp_tests2_1d.F90.in:104
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:105
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:106
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:107
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:108
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:109
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:110
  integer, dimension(:), allocatable :: start, count   ! pio_decomp_tests2_1d.F90.in:111
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:112
  real(kind=fc_real), dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:113
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:114
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:115
  integer :: i, j, k, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:116
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:118
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:119
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:120
   ! pio_decomp_tests2_1d.F90.in:121
  ! Set the decomposition for writing data
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests2_1d.F90.in:123
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:124)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:124
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:125)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:125
   ! pio_decomp_tests2_1d.F90.in:126
  tot_count = 0   ! pio_decomp_tests2_1d.F90.in:127
  do i=1,size(count)   ! pio_decomp_tests2_1d.F90.in:128
    tot_count = tot_count + count(i)    ! pio_decomp_tests2_1d.F90.in:129
  end do   ! pio_decomp_tests2_1d.F90.in:130
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:131
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:132
  k = 1   ! pio_decomp_tests2_1d.F90.in:133
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:134
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:135
      wbuf(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:136
      compdof(k) = wbuf(k)   ! pio_decomp_tests2_1d.F90.in:137
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:138
    end do   ! pio_decomp_tests2_1d.F90.in:139
  end do   ! pio_decomp_tests2_1d.F90.in:140
   ! pio_decomp_tests2_1d.F90.in:141
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:142
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:143
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:144
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:145
   ! pio_decomp_tests2_1d.F90.in:146
  ! Set the decomposition for reading data
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:148
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:149
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:150
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests2_1d.F90.in:151
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:152)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:152
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:153)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:153
   ! pio_decomp_tests2_1d.F90.in:154
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:155
  k = 1   ! pio_decomp_tests2_1d.F90.in:156
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:157
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:158
      exp_val(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:159
      compdof(k) = exp_val(k)   ! pio_decomp_tests2_1d.F90.in:160
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:161
    end do   ! pio_decomp_tests2_1d.F90.in:162
  end do   ! pio_decomp_tests2_1d.F90.in:163
   ! pio_decomp_tests2_1d.F90.in:164
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:165
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:166
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:167
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:168
   ! pio_decomp_tests2_1d.F90.in:169
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:171
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:172
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:173
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:174

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:175
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:176
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:177)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:177
   ! pio_decomp_tests2_1d.F90.in:178
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:179
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:180)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:180
   ! pio_decomp_tests2_1d.F90.in:181
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:182
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:183)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:183
   ! pio_decomp_tests2_1d.F90.in:184
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:185
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:186)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:186
   ! pio_decomp_tests2_1d.F90.in:187
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:189
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:190)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:190
   ! pio_decomp_tests2_1d.F90.in:191
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:193
   ! pio_decomp_tests2_1d.F90.in:194
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:195
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:196)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:196
   ! pio_decomp_tests2_1d.F90.in:197
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:199
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:201
#endif
   ! pio_decomp_tests2_1d.F90.in:203
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:204
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:205)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:205
   ! pio_decomp_tests2_1d.F90.in:206
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:207)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:207
   ! pio_decomp_tests2_1d.F90.in:208
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:209
       ! pio_decomp_tests2_1d.F90.in:210
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:211
  end do   ! pio_decomp_tests2_1d.F90.in:212
   ! pio_decomp_tests2_1d.F90.in:213
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:214
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:215
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:216
  end if   ! pio_decomp_tests2_1d.F90.in:217
   ! pio_decomp_tests2_1d.F90.in:218
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:219
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:220
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:221
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:222
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:223
END SUBROUTINE nc_wr_rd_a2a_PIO_real_real_kind_fc_real___   ! pio_decomp_tests2_1d.F90.in:224


SUBROUTINE nc_wr_rd_a2a_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:93
  implicit none   ! pio_decomp_tests2_1d.F90.in:94
  INTERFACE   ! pio_decomp_tests2_1d.F90.in:95
    SUBROUTINE get_1d_a2a_info(rank, sz, dims, start, count, force_all2all)   ! pio_decomp_tests2_1d.F90.in:96
      integer, intent(in) :: rank   ! pio_decomp_tests2_1d.F90.in:97
      integer, intent(in) :: sz   ! pio_decomp_tests2_1d.F90.in:98
      integer, dimension(1), intent(out) :: dims   ! pio_decomp_tests2_1d.F90.in:99
      integer, dimension(:), allocatable, intent(out) :: start   ! pio_decomp_tests2_1d.F90.in:100
      integer, dimension(:), allocatable, intent(out) :: count   ! pio_decomp_tests2_1d.F90.in:101
      logical, intent(in) :: force_all2all   ! pio_decomp_tests2_1d.F90.in:102
    END SUBROUTINE get_1d_a2a_info   ! pio_decomp_tests2_1d.F90.in:103
  END INTERFACE   ! pio_decomp_tests2_1d.F90.in:104
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:105
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:106
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:107
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:108
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:109
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:110
  integer, dimension(:), allocatable :: start, count   ! pio_decomp_tests2_1d.F90.in:111
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:112
  real(kind=fc_double), dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:113
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:114
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:115
  integer :: i, j, k, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:116
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:118
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:119
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:120
   ! pio_decomp_tests2_1d.F90.in:121
  ! Set the decomposition for writing data
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests2_1d.F90.in:123
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:124)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:124
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for wr decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:125)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:125
   ! pio_decomp_tests2_1d.F90.in:126
  tot_count = 0   ! pio_decomp_tests2_1d.F90.in:127
  do i=1,size(count)   ! pio_decomp_tests2_1d.F90.in:128
    tot_count = tot_count + count(i)    ! pio_decomp_tests2_1d.F90.in:129
  end do   ! pio_decomp_tests2_1d.F90.in:130
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:131
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:132
  k = 1   ! pio_decomp_tests2_1d.F90.in:133
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:134
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:135
      wbuf(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:136
      compdof(k) = wbuf(k)   ! pio_decomp_tests2_1d.F90.in:137
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:138
    end do   ! pio_decomp_tests2_1d.F90.in:139
  end do   ! pio_decomp_tests2_1d.F90.in:140
   ! pio_decomp_tests2_1d.F90.in:141
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:142
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:143
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:144
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:145
   ! pio_decomp_tests2_1d.F90.in:146
  ! Set the decomposition for reading data
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:148
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:149
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:150
  call get_1d_a2a_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests2_1d.F90.in:151
  
  IF (.NOT. (PIO_TF_Passert_(size(start) == size(count), pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start/count calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:152)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:152
  
  IF (.NOT. (PIO_TF_Passert_(size(start) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for rd decomposition",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:153)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:153
   ! pio_decomp_tests2_1d.F90.in:154
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:155
  k = 1   ! pio_decomp_tests2_1d.F90.in:156
  do i=1,size(start)   ! pio_decomp_tests2_1d.F90.in:157
    do j=1,count(i)   ! pio_decomp_tests2_1d.F90.in:158
      exp_val(k) = start(i) + j - 1   ! pio_decomp_tests2_1d.F90.in:159
      compdof(k) = exp_val(k)   ! pio_decomp_tests2_1d.F90.in:160
      k = k + 1   ! pio_decomp_tests2_1d.F90.in:161
    end do   ! pio_decomp_tests2_1d.F90.in:162
  end do   ! pio_decomp_tests2_1d.F90.in:163
   ! pio_decomp_tests2_1d.F90.in:164
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:165
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:166
  deallocate(start)   ! pio_decomp_tests2_1d.F90.in:167
  deallocate(count)   ! pio_decomp_tests2_1d.F90.in:168
   ! pio_decomp_tests2_1d.F90.in:169
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:171
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:172
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:173
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:174

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:175
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:176
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:177)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:177
   ! pio_decomp_tests2_1d.F90.in:178
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:179
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:180)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:180
   ! pio_decomp_tests2_1d.F90.in:181
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:182
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:183)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:183
   ! pio_decomp_tests2_1d.F90.in:184
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:185
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:186)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:186
   ! pio_decomp_tests2_1d.F90.in:187
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:189
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:190)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:190
   ! pio_decomp_tests2_1d.F90.in:191
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:193
   ! pio_decomp_tests2_1d.F90.in:194
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:195
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:196)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:196
   ! pio_decomp_tests2_1d.F90.in:197
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:199
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:201
#endif
   ! pio_decomp_tests2_1d.F90.in:203
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:204
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:205)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:205
   ! pio_decomp_tests2_1d.F90.in:206
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:207)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:207
   ! pio_decomp_tests2_1d.F90.in:208
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:209
       ! pio_decomp_tests2_1d.F90.in:210
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:211
  end do   ! pio_decomp_tests2_1d.F90.in:212
   ! pio_decomp_tests2_1d.F90.in:213
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:214
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:215
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:216
  end if   ! pio_decomp_tests2_1d.F90.in:217
   ! pio_decomp_tests2_1d.F90.in:218
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:219
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:220
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:221
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:222
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:223
END SUBROUTINE nc_wr_rd_a2a_PIO_double_real_kind_fc_double___   ! pio_decomp_tests2_1d.F90.in:224
   ! pio_decomp_tests2_1d.F90.in:224


! Write (and read back) data with a decomposition that is not
! monotonically increasing (is local reverse of block cyclic decomposition)


SUBROUTINE nc_wr_rev_rd_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:229
  implicit none   ! pio_decomp_tests2_1d.F90.in:230
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:231
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:232
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:233
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:234
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:235
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:236
  integer, dimension(1) :: start, count   ! pio_decomp_tests2_1d.F90.in:237
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:238
  integer, dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:239
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:240
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:241
  integer :: i, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:242
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:244
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:245
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:246
   ! pio_decomp_tests2_1d.F90.in:247
  ! Set the decomposition for writing data
  ! The data is written out using reverse order of the block decomposition
  ! returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is written out with [12, 11, 10]
  call get_1d_bc_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count)   ! pio_decomp_tests2_1d.F90.in:253
  
  IF (.NOT. (PIO_TF_Passert_(start(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:254)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:254
  
  IF (.NOT. (PIO_TF_Passert_(count(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid count calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:255)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:255
   ! pio_decomp_tests2_1d.F90.in:256
  tot_count = count(1)   ! pio_decomp_tests2_1d.F90.in:257
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:258
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:259
   ! pio_decomp_tests2_1d.F90.in:260
  ! Reverse the local decomposition
  do i=1,count(1)   ! pio_decomp_tests2_1d.F90.in:262
    wbuf(i) = start(1) + count(1) - i   ! pio_decomp_tests2_1d.F90.in:263
    compdof(i) = wbuf(i)   ! pio_decomp_tests2_1d.F90.in:264
  end do   ! pio_decomp_tests2_1d.F90.in:265
   ! pio_decomp_tests2_1d.F90.in:266
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:267
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:268
   ! pio_decomp_tests2_1d.F90.in:269
  ! Set the decomposition for reading data
  ! The data is read out using a cyclic left-shifted (by 1) order of the block
  ! decomposition returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is read with [11, 12, 10]
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:275
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:276
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:277
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:278
   ! pio_decomp_tests2_1d.F90.in:279
  do i=2,count(1)   ! pio_decomp_tests2_1d.F90.in:280
    exp_val(i-1) = start(1) + i - 1   ! pio_decomp_tests2_1d.F90.in:281
    compdof(i-1) = exp_val(i-1)   ! pio_decomp_tests2_1d.F90.in:282
  end do   ! pio_decomp_tests2_1d.F90.in:283
  exp_val(count(1)) = start(1)   ! pio_decomp_tests2_1d.F90.in:284
  compdof(count(1)) = exp_val(count(1))   ! pio_decomp_tests2_1d.F90.in:285
   ! pio_decomp_tests2_1d.F90.in:286
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:287
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:288
   ! pio_decomp_tests2_1d.F90.in:289
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:291
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:292
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:293
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:294

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:295
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:297
   ! pio_decomp_tests2_1d.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:300
   ! pio_decomp_tests2_1d.F90.in:301
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:303
   ! pio_decomp_tests2_1d.F90.in:304
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:306
   ! pio_decomp_tests2_1d.F90.in:307
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:309
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:310)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:310
   ! pio_decomp_tests2_1d.F90.in:311
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:313
   ! pio_decomp_tests2_1d.F90.in:314
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:315
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:316)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:316
   ! pio_decomp_tests2_1d.F90.in:317
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:318
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:319)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:319
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:321
#endif
   ! pio_decomp_tests2_1d.F90.in:323
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:325
   ! pio_decomp_tests2_1d.F90.in:326
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:327)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:327
   ! pio_decomp_tests2_1d.F90.in:328
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:329
       ! pio_decomp_tests2_1d.F90.in:330
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:331
  end do   ! pio_decomp_tests2_1d.F90.in:332
   ! pio_decomp_tests2_1d.F90.in:333
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:334
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:335
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:336
  end if   ! pio_decomp_tests2_1d.F90.in:337
   ! pio_decomp_tests2_1d.F90.in:338
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:339
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:340
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:341
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:342
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:343
END SUBROUTINE nc_wr_rev_rd_PIO_int_integer__   ! pio_decomp_tests2_1d.F90.in:344


SUBROUTINE nc_wr_rev_rd_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:229
  implicit none   ! pio_decomp_tests2_1d.F90.in:230
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:231
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:232
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:233
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:234
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:235
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:236
  integer, dimension(1) :: start, count   ! pio_decomp_tests2_1d.F90.in:237
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:238
  real(kind=fc_real), dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:239
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:240
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:241
  integer :: i, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:242
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:244
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:245
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:246
   ! pio_decomp_tests2_1d.F90.in:247
  ! Set the decomposition for writing data
  ! The data is written out using reverse order of the block decomposition
  ! returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is written out with [12, 11, 10]
  call get_1d_bc_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count)   ! pio_decomp_tests2_1d.F90.in:253
  
  IF (.NOT. (PIO_TF_Passert_(start(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:254)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:254
  
  IF (.NOT. (PIO_TF_Passert_(count(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid count calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:255)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:255
   ! pio_decomp_tests2_1d.F90.in:256
  tot_count = count(1)   ! pio_decomp_tests2_1d.F90.in:257
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:258
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:259
   ! pio_decomp_tests2_1d.F90.in:260
  ! Reverse the local decomposition
  do i=1,count(1)   ! pio_decomp_tests2_1d.F90.in:262
    wbuf(i) = start(1) + count(1) - i   ! pio_decomp_tests2_1d.F90.in:263
    compdof(i) = wbuf(i)   ! pio_decomp_tests2_1d.F90.in:264
  end do   ! pio_decomp_tests2_1d.F90.in:265
   ! pio_decomp_tests2_1d.F90.in:266
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:267
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:268
   ! pio_decomp_tests2_1d.F90.in:269
  ! Set the decomposition for reading data
  ! The data is read out using a cyclic left-shifted (by 1) order of the block
  ! decomposition returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is read with [11, 12, 10]
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:275
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:276
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:277
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:278
   ! pio_decomp_tests2_1d.F90.in:279
  do i=2,count(1)   ! pio_decomp_tests2_1d.F90.in:280
    exp_val(i-1) = start(1) + i - 1   ! pio_decomp_tests2_1d.F90.in:281
    compdof(i-1) = exp_val(i-1)   ! pio_decomp_tests2_1d.F90.in:282
  end do   ! pio_decomp_tests2_1d.F90.in:283
  exp_val(count(1)) = start(1)   ! pio_decomp_tests2_1d.F90.in:284
  compdof(count(1)) = exp_val(count(1))   ! pio_decomp_tests2_1d.F90.in:285
   ! pio_decomp_tests2_1d.F90.in:286
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:287
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:288
   ! pio_decomp_tests2_1d.F90.in:289
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:291
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:292
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:293
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:294

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:295
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:297
   ! pio_decomp_tests2_1d.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:300
   ! pio_decomp_tests2_1d.F90.in:301
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:303
   ! pio_decomp_tests2_1d.F90.in:304
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:306
   ! pio_decomp_tests2_1d.F90.in:307
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:309
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:310)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:310
   ! pio_decomp_tests2_1d.F90.in:311
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:313
   ! pio_decomp_tests2_1d.F90.in:314
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:315
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:316)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:316
   ! pio_decomp_tests2_1d.F90.in:317
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:318
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:319)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:319
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:321
#endif
   ! pio_decomp_tests2_1d.F90.in:323
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:325
   ! pio_decomp_tests2_1d.F90.in:326
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:327)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:327
   ! pio_decomp_tests2_1d.F90.in:328
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:329
       ! pio_decomp_tests2_1d.F90.in:330
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:331
  end do   ! pio_decomp_tests2_1d.F90.in:332
   ! pio_decomp_tests2_1d.F90.in:333
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:334
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:335
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:336
  end if   ! pio_decomp_tests2_1d.F90.in:337
   ! pio_decomp_tests2_1d.F90.in:338
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:339
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:340
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:341
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:342
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:343
END SUBROUTINE nc_wr_rev_rd_PIO_real_real_kind_fc_real___   ! pio_decomp_tests2_1d.F90.in:344


SUBROUTINE nc_wr_rev_rd_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_tests2_1d.F90.in:229
  implicit none   ! pio_decomp_tests2_1d.F90.in:230
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests2_1d.F90.in:231
  type(file_desc_t) :: pio_file   ! pio_decomp_tests2_1d.F90.in:232
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests2_1d.F90.in:233
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests2_1d.F90.in:234
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests2_1d.F90.in:235
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests2_1d.F90.in:236
  integer, dimension(1) :: start, count   ! pio_decomp_tests2_1d.F90.in:237
  integer :: tot_count   ! pio_decomp_tests2_1d.F90.in:238
  real(kind=fc_double), dimension(:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests2_1d.F90.in:239
  integer, dimension(1) :: dims   ! pio_decomp_tests2_1d.F90.in:240
  integer :: pio_dim   ! pio_decomp_tests2_1d.F90.in:241
  integer :: i, ierr, lsz   ! pio_decomp_tests2_1d.F90.in:242
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests2_1d.F90.in:244
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests2_1d.F90.in:245
  integer :: num_iotypes   ! pio_decomp_tests2_1d.F90.in:246
   ! pio_decomp_tests2_1d.F90.in:247
  ! Set the decomposition for writing data
  ! The data is written out using reverse order of the block decomposition
  ! returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is written out with [12, 11, 10]
  call get_1d_bc_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count)   ! pio_decomp_tests2_1d.F90.in:253
  
  IF (.NOT. (PIO_TF_Passert_(start(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid start calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:254)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:254
  
  IF (.NOT. (PIO_TF_Passert_(count(1) > 0, pio_tf_comm_))) THEN
    pio_tf_retval_utest_ = -1
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Assertion failed :",&
         "Invalid count calculated for bc decomp",&
         ":", __FILE__, ":", __LINE__,&
        "(pio_decomp_tests2_1d.F90.in:255)"
    END IF
    RETURN
  END IF   ! pio_decomp_tests2_1d.F90.in:255
   ! pio_decomp_tests2_1d.F90.in:256
  tot_count = count(1)   ! pio_decomp_tests2_1d.F90.in:257
  allocate(wbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:258
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:259
   ! pio_decomp_tests2_1d.F90.in:260
  ! Reverse the local decomposition
  do i=1,count(1)   ! pio_decomp_tests2_1d.F90.in:262
    wbuf(i) = start(1) + count(1) - i   ! pio_decomp_tests2_1d.F90.in:263
    compdof(i) = wbuf(i)   ! pio_decomp_tests2_1d.F90.in:264
  end do   ! pio_decomp_tests2_1d.F90.in:265
   ! pio_decomp_tests2_1d.F90.in:266
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:267
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:268
   ! pio_decomp_tests2_1d.F90.in:269
  ! Set the decomposition for reading data
  ! The data is read out using a cyclic left-shifted (by 1) order of the block
  ! decomposition returned by get_1d_bc_info()
  ! e.g. start = 10, count = 3
  ! The data is read with [11, 12, 10]
  allocate(rbuf(tot_count))   ! pio_decomp_tests2_1d.F90.in:275
  rbuf = 0   ! pio_decomp_tests2_1d.F90.in:276
  allocate(exp_val(tot_count))   ! pio_decomp_tests2_1d.F90.in:277
  allocate(compdof(tot_count))   ! pio_decomp_tests2_1d.F90.in:278
   ! pio_decomp_tests2_1d.F90.in:279
  do i=2,count(1)   ! pio_decomp_tests2_1d.F90.in:280
    exp_val(i-1) = start(1) + i - 1   ! pio_decomp_tests2_1d.F90.in:281
    compdof(i-1) = exp_val(i-1)   ! pio_decomp_tests2_1d.F90.in:282
  end do   ! pio_decomp_tests2_1d.F90.in:283
  exp_val(count(1)) = start(1)   ! pio_decomp_tests2_1d.F90.in:284
  compdof(count(1)) = exp_val(count(1))   ! pio_decomp_tests2_1d.F90.in:285
   ! pio_decomp_tests2_1d.F90.in:286
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:287
  deallocate(compdof)   ! pio_decomp_tests2_1d.F90.in:288
   ! pio_decomp_tests2_1d.F90.in:289
  ! Define/write/read data
  num_iotypes = 0   ! pio_decomp_tests2_1d.F90.in:291
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests2_1d.F90.in:292
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests2_1d.F90.in:293
  do i=1,num_iotypes   ! pio_decomp_tests2_1d.F90.in:294

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests2_1d.F90.in:295
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests2_1d.F90.in:296
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:297)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:297
   ! pio_decomp_tests2_1d.F90.in:298
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_decomp_tests2_1d.F90.in:299
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:300)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:300
   ! pio_decomp_tests2_1d.F90.in:301
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, (/pio_dim/), pio_var)   ! pio_decomp_tests2_1d.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:303
   ! pio_decomp_tests2_1d.F90.in:304
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests2_1d.F90.in:305
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:306)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:306
   ! pio_decomp_tests2_1d.F90.in:307
    ! Write the variable out - alltoall communication forced via wr_iodesc
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:309
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:310)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:310
   ! pio_decomp_tests2_1d.F90.in:311
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:313
   ! pio_decomp_tests2_1d.F90.in:314
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests2_1d.F90.in:315
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:316)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:316
   ! pio_decomp_tests2_1d.F90.in:317
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests2_1d.F90.in:318
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:319)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:319
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests2_1d.F90.in:321
#endif
   ! pio_decomp_tests2_1d.F90.in:323
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests2_1d.F90.in:324
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:325)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:325
   ! pio_decomp_tests2_1d.F90.in:326
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests2_1d.F90.in:327)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests2_1d.F90.in:327
   ! pio_decomp_tests2_1d.F90.in:328
    call PIO_closefile(pio_file)   ! pio_decomp_tests2_1d.F90.in:329
       ! pio_decomp_tests2_1d.F90.in:330
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests2_1d.F90.in:331
  end do   ! pio_decomp_tests2_1d.F90.in:332
   ! pio_decomp_tests2_1d.F90.in:333
  if(allocated(iotypes)) then   ! pio_decomp_tests2_1d.F90.in:334
    deallocate(iotypes)   ! pio_decomp_tests2_1d.F90.in:335
    deallocate(iotype_descs)   ! pio_decomp_tests2_1d.F90.in:336
  end if   ! pio_decomp_tests2_1d.F90.in:337
   ! pio_decomp_tests2_1d.F90.in:338
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests2_1d.F90.in:339
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests2_1d.F90.in:340
  deallocate(exp_val)   ! pio_decomp_tests2_1d.F90.in:341
  deallocate(rbuf)   ! pio_decomp_tests2_1d.F90.in:342
  deallocate(wbuf)   ! pio_decomp_tests2_1d.F90.in:343
END SUBROUTINE nc_wr_rev_rd_PIO_double_real_kind_fc_double___   ! pio_decomp_tests2_1d.F90.in:344
   ! pio_decomp_tests2_1d.F90.in:344


  SUBROUTINE PIO_TF_Test_driver_
    USE pio_tutil
    IMPLICIT NONE
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_int_integer__"
    END IF
    CALL nc_wr_rd_a2a_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_rd_a2a_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_rd_a2a_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rd_a2a_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_rd_a2a_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_rd_a2a_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rd_a2a_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_rd_a2a_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_rd_a2a_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_int_integer__"
    END IF
    CALL nc_wr_rd_a2a_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_rd_a2a_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_rd_a2a_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rd_a2a_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_rd_a2a_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_rd_a2a_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rd_a2a_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rd_a2a_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_rd_a2a_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_rd_a2a_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rev_rd_PIO_int_integer__"
    END IF
    CALL nc_wr_rev_rd_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_wr_rev_rd_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_wr_rev_rd_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rev_rd_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_rev_rd_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_wr_rev_rd_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_wr_rev_rd_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_rev_rd_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_rev_rd_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_wr_rev_rd_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_wr_rev_rd_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
  END SUBROUTINE PIO_TF_Test_driver_


  PROGRAM PIO_TF_Test_main_
    USE pio_tutil
    IMPLICIT NONE
    INTEGER, PARAMETER :: NREARRS = 2
    INTEGER :: rearrs(NREARRS) = (/pio_rearr_subset,pio_rearr_box/)
    CHARACTER(LEN=PIO_TF_MAX_STR_LEN) :: rearrs_info(NREARRS) = (/"PIO_REARR_SUBSET","PIO_REARR_BOX   "/)
    INTEGER i, ierr

    pio_tf_nerrs_total_=0
    pio_tf_retval_utest_=0
    CALL MPI_Init(ierr)
    DO i=1,SIZE(rearrs)
      CALL PIO_TF_Init_(rearrs(i))
      IF (pio_tf_world_rank_ == 0) THEN
        WRITE(*,*) "PIO_TF: Testing : ", trim(rearrs_info(i))
      END IF
      CALL PIO_TF_Test_driver_()
      CALL PIO_TF_Finalize_()
    END DO
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_nerrs_total_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "All tests", "---------", "PASSED"
        ELSE
          pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "Test driver", "---------", "FAILED"
        END IF
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT2) "PIO_TF:[",&
          pio_tf_nerrs_total_,"] Tests",&
          "----- FAILED"
      END IF
    END IF
    CALL MPI_Finalize(ierr)
    IF (pio_tf_nerrs_total_ /= 0) THEN
      STOP 99
    END IF
  END PROGRAM
