! DON'T MODIFY THIS FILE, ALL YOUR CHANGES WILL BE LOST
! This file is generated by ../../../tests/general/util/pio_tf_f90gen.pl
! from /home/tkurc/codar/e3sm/pio_adios1/ParallelIO/tests/general/pio_buf_lim_tests.F90.in

#ifndef NO_C_SIZEOF
#define TYPE_SIZEOF(x) (C_SIZEOF(x)/SIZE(x))
#else
#define TYPE_SIZEOF(x) (SIZE(TRANSFER(x,bbuf))/SIZE(x))
#endif
! Get the iobuf size
! lbuf_sz -> local buffer size
! lbuf_type_sz -> local buffer type size
! nbufs -> number of buffers before a flush
! The size of iobuf is calculated so that a flush is
! called every nbufs 
! (iobuf_sz < lbuf_sz * lbuf_type_sz * nbufs)
SUBROUTINE get_iobuf_sz(lbuf_sz, lbuf_type_sz, nbufs, iobuf_sz)   ! pio_buf_lim_tests.F90.in:13
  use pio_tutil   ! pio_buf_lim_tests.F90.in:14
  implicit none   ! pio_buf_lim_tests.F90.in:15
  integer, intent(in) :: lbuf_sz   ! pio_buf_lim_tests.F90.in:16
  integer, intent(in) :: lbuf_type_sz   ! pio_buf_lim_tests.F90.in:17
  integer, intent(in) :: nbufs   ! pio_buf_lim_tests.F90.in:18
  integer(kind=pio_offset_kind), intent(out) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:19


  !print *, "lbuf_sz = ", lbuf_sz, "lbuf_type_sz = ", lbuf_type_sz,&
  !          "nbufs = ", nbufs, "iobuf_sz = ", iobuf_sz
  iobuf_sz = lbuf_sz * lbuf_type_sz * nbufs - 1   ! pio_buf_lim_tests.F90.in:23
  if(iobuf_sz < 0) then   ! pio_buf_lim_tests.F90.in:24

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "IO buffer size < 0, resetting to 0"
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:25
    iobuf_sz = 0   ! pio_buf_lim_tests.F90.in:26
  end if   ! pio_buf_lim_tests.F90.in:27
END SUBROUTINE   ! pio_buf_lim_tests.F90.in:28


! Test that writes out multiple variables with buffer limit set to 0


SUBROUTINE nc_wr_buf_limit_zero_PIO_int_integer__
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:32
  implicit none   ! pio_buf_lim_tests.F90.in:33
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:34
  integer(kind=pio_offset_kind), parameter :: PIO_BUFFER_SZ_ZERO = 0   ! pio_buf_lim_tests.F90.in:35
  type(var_desc_t)  :: pio_var   ! pio_buf_lim_tests.F90.in:36
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:37
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:38
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_buf_lim_tests.F90.in:39
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:40
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:41
  integer, dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:42
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:43
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:44
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:45
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:47
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:48
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:49
   ! pio_buf_lim_tests.F90.in:50
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:51
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:52
  end do   ! pio_buf_lim_tests.F90.in:53
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:54
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:55
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:56
   ! pio_buf_lim_tests.F90.in:57
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:58
   ! pio_buf_lim_tests.F90.in:59
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:60
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:61
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:62
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:63

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:64
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:65
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:66)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:66
   ! pio_buf_lim_tests.F90.in:67
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:68
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:69)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:69
   ! pio_buf_lim_tests.F90.in:70
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, (/pio_dim/), pio_var)   ! pio_buf_lim_tests.F90.in:71
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:72)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:72
   ! pio_buf_lim_tests.F90.in:73
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:74
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:75)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:75
   ! pio_buf_lim_tests.F90.in:76
    call pio_set_buffer_size_limit(PIO_BUFFER_SZ_ZERO)   ! pio_buf_lim_tests.F90.in:77
   ! pio_buf_lim_tests.F90.in:78
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:80
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:81)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:81
   ! pio_buf_lim_tests.F90.in:82
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:84
   ! pio_buf_lim_tests.F90.in:85
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_buf_lim_tests.F90.in:86
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:87)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:87
   ! pio_buf_lim_tests.F90.in:88
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_buf_lim_tests.F90.in:89
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var: " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:90)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:90
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:92
#endif
   ! pio_buf_lim_tests.F90.in:94
    rbuf = 0   ! pio_buf_lim_tests.F90.in:95
    call PIO_read_darray(pio_file, pio_var, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:96
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:97)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:97
   ! pio_buf_lim_tests.F90.in:98
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:99)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:99
   ! pio_buf_lim_tests.F90.in:100
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:101
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:102
  end do   ! pio_buf_lim_tests.F90.in:103
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:104
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:105
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:106
  end if   ! pio_buf_lim_tests.F90.in:107
   ! pio_buf_lim_tests.F90.in:108
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:109
END SUBROUTINE nc_wr_buf_limit_zero_PIO_int_integer__   ! pio_buf_lim_tests.F90.in:110


SUBROUTINE nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:32
  implicit none   ! pio_buf_lim_tests.F90.in:33
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:34
  integer(kind=pio_offset_kind), parameter :: PIO_BUFFER_SZ_ZERO = 0   ! pio_buf_lim_tests.F90.in:35
  type(var_desc_t)  :: pio_var   ! pio_buf_lim_tests.F90.in:36
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:37
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:38
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_buf_lim_tests.F90.in:39
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:40
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:41
  real(kind=fc_real), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:42
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:43
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:44
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:45
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:47
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:48
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:49
   ! pio_buf_lim_tests.F90.in:50
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:51
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:52
  end do   ! pio_buf_lim_tests.F90.in:53
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:54
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:55
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:56
   ! pio_buf_lim_tests.F90.in:57
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:58
   ! pio_buf_lim_tests.F90.in:59
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:60
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:61
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:62
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:63

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:64
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:65
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:66)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:66
   ! pio_buf_lim_tests.F90.in:67
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:68
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:69)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:69
   ! pio_buf_lim_tests.F90.in:70
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, (/pio_dim/), pio_var)   ! pio_buf_lim_tests.F90.in:71
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:72)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:72
   ! pio_buf_lim_tests.F90.in:73
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:74
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:75)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:75
   ! pio_buf_lim_tests.F90.in:76
    call pio_set_buffer_size_limit(PIO_BUFFER_SZ_ZERO)   ! pio_buf_lim_tests.F90.in:77
   ! pio_buf_lim_tests.F90.in:78
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:80
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:81)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:81
   ! pio_buf_lim_tests.F90.in:82
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:84
   ! pio_buf_lim_tests.F90.in:85
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_buf_lim_tests.F90.in:86
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:87)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:87
   ! pio_buf_lim_tests.F90.in:88
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_buf_lim_tests.F90.in:89
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var: " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:90)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:90
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:92
#endif
   ! pio_buf_lim_tests.F90.in:94
    rbuf = 0   ! pio_buf_lim_tests.F90.in:95
    call PIO_read_darray(pio_file, pio_var, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:96
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:97)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:97
   ! pio_buf_lim_tests.F90.in:98
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:99)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:99
   ! pio_buf_lim_tests.F90.in:100
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:101
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:102
  end do   ! pio_buf_lim_tests.F90.in:103
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:104
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:105
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:106
  end if   ! pio_buf_lim_tests.F90.in:107
   ! pio_buf_lim_tests.F90.in:108
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:109
END SUBROUTINE nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___   ! pio_buf_lim_tests.F90.in:110


SUBROUTINE nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:32
  implicit none   ! pio_buf_lim_tests.F90.in:33
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:34
  integer(kind=pio_offset_kind), parameter :: PIO_BUFFER_SZ_ZERO = 0   ! pio_buf_lim_tests.F90.in:35
  type(var_desc_t)  :: pio_var   ! pio_buf_lim_tests.F90.in:36
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:37
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:38
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_buf_lim_tests.F90.in:39
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:40
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:41
  real(kind=fc_double), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:42
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:43
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:44
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:45
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:47
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:48
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:49
   ! pio_buf_lim_tests.F90.in:50
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:51
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:52
  end do   ! pio_buf_lim_tests.F90.in:53
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:54
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:55
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:56
   ! pio_buf_lim_tests.F90.in:57
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:58
   ! pio_buf_lim_tests.F90.in:59
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:60
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:61
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:62
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:63

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:64
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:65
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:66)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:66
   ! pio_buf_lim_tests.F90.in:67
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:68
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:69)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:69
   ! pio_buf_lim_tests.F90.in:70
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, (/pio_dim/), pio_var)   ! pio_buf_lim_tests.F90.in:71
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:72)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:72
   ! pio_buf_lim_tests.F90.in:73
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:74
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:75)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:75
   ! pio_buf_lim_tests.F90.in:76
    call pio_set_buffer_size_limit(PIO_BUFFER_SZ_ZERO)   ! pio_buf_lim_tests.F90.in:77
   ! pio_buf_lim_tests.F90.in:78
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:80
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:81)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:81
   ! pio_buf_lim_tests.F90.in:82
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:84
   ! pio_buf_lim_tests.F90.in:85
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_buf_lim_tests.F90.in:86
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:87)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:87
   ! pio_buf_lim_tests.F90.in:88
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_buf_lim_tests.F90.in:89
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var: " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:90)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:90
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:92
#endif
   ! pio_buf_lim_tests.F90.in:94
    rbuf = 0   ! pio_buf_lim_tests.F90.in:95
    call PIO_read_darray(pio_file, pio_var, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:96
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:97)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:97
   ! pio_buf_lim_tests.F90.in:98
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:99)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:99
   ! pio_buf_lim_tests.F90.in:100
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:101
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:102
  end do   ! pio_buf_lim_tests.F90.in:103
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:104
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:105
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:106
  end if   ! pio_buf_lim_tests.F90.in:107
   ! pio_buf_lim_tests.F90.in:108
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:109
END SUBROUTINE nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___   ! pio_buf_lim_tests.F90.in:110
   ! pio_buf_lim_tests.F90.in:110


! Test that writes out multiple variables with implicit flush
! The flush is not explicitly invoked using pio_syncfile, instead
! implicitly invoked due to the buffer size limit set for the io
! procs


SUBROUTINE nc_wr_mvar_impl_flush_PIO_int_integer__
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:117
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:119
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:121
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:122
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:123
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:124
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3, pio_var4   ! pio_buf_lim_tests.F90.in:125
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:126
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:127
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:128
  character(len=*), parameter :: PIO_VAR4_NAME = 'PIO_TF_test_var4'   ! pio_buf_lim_tests.F90.in:129
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:130
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:131
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:132
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:133
  integer, dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:134
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:135
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:136
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:137
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:138
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:140
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:141
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:142
   ! pio_buf_lim_tests.F90.in:143
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:144
   ! pio_buf_lim_tests.F90.in:145
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:146
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:147
  end do   ! pio_buf_lim_tests.F90.in:148
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:149
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:150
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:151
   ! pio_buf_lim_tests.F90.in:152
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:153
   ! pio_buf_lim_tests.F90.in:154
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:155
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:156
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:157
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:158

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:159
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:160
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:161)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:161
   ! pio_buf_lim_tests.F90.in:162
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:163
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:164)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:164
   ! pio_buf_lim_tests.F90.in:165
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_int, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:166
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:167)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:167
   ! pio_buf_lim_tests.F90.in:168
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_int, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:169
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:170)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:170
   ! pio_buf_lim_tests.F90.in:171
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_int, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:172
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:173)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:173
   ! pio_buf_lim_tests.F90.in:174
    ierr = PIO_def_var(pio_file, PIO_VAR4_NAME, PIO_int, (/pio_dim/), pio_var4)   ! pio_buf_lim_tests.F90.in:175
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:176)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:176
   ! pio_buf_lim_tests.F90.in:177
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:178
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:179)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:179
   ! pio_buf_lim_tests.F90.in:180
    ! Set the buffer size limit such that we trigger an implicit flush
    ! on the next write. To flush every var set the buffer size limit
    ! to be slightly less than the size (local) required to cache a
    ! single variable. When the second variable is written out the first
    ! variable will be flushed out (since internal cache >= buffer size limit)
   ! pio_buf_lim_tests.F90.in:186
    ! ============ Flush every var ======================
    ! Before the 2nd variable is written out the data
    ! corresponding to the first variable will be flushed out
   ! pio_buf_lim_tests.F90.in:190
    ! Set the buffer size limit to be slightly less than required
    ! for a single variable
    call get_iobuf_sz(size(wbuf), type_sz, 1, iobuf_sz)   ! pio_buf_lim_tests.F90.in:193
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:194

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 1 var : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:195
   ! pio_buf_lim_tests.F90.in:196
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:199
   ! pio_buf_lim_tests.F90.in:200
    ! Flush for the first variable should happen inside PIO_write_darray(pio_var2)
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:202
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:203)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:203
   ! pio_buf_lim_tests.F90.in:204
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:206
   ! pio_buf_lim_tests.F90.in:207
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:208
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:209)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:209
   ! pio_buf_lim_tests.F90.in:210
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:211
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:212)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:212
   ! pio_buf_lim_tests.F90.in:213
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:214
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:215)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:215
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:217
#endif
   ! pio_buf_lim_tests.F90.in:219
    rbuf = 0   ! pio_buf_lim_tests.F90.in:220
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:221
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:222)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:222
   ! pio_buf_lim_tests.F90.in:223
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:224
   ! pio_buf_lim_tests.F90.in:225
    rbuf = 0   ! pio_buf_lim_tests.F90.in:226
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:227
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:228)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:228
   ! pio_buf_lim_tests.F90.in:229
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:230
   ! pio_buf_lim_tests.F90.in:231
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:233
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:234

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:235
   ! pio_buf_lim_tests.F90.in:236
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:238
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:239)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:239
   ! pio_buf_lim_tests.F90.in:240
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:241
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:242)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:242
   ! pio_buf_lim_tests.F90.in:243
    ! Flush for the previous 2 vars, pio_var1 and pio_var2 should happen
    ! inside PIO_write_darray(pio_var3)
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:246
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:247)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:247
   ! pio_buf_lim_tests.F90.in:248
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:250
   ! pio_buf_lim_tests.F90.in:251
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:252
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:253)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:253
   ! pio_buf_lim_tests.F90.in:254
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:255
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:256)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:256
   ! pio_buf_lim_tests.F90.in:257
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:258
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:259)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:259
   ! pio_buf_lim_tests.F90.in:260
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:261
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:262)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:262
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:264
#endif
   ! pio_buf_lim_tests.F90.in:266
    rbuf = 0   ! pio_buf_lim_tests.F90.in:267
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:268
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:269)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:269
   ! pio_buf_lim_tests.F90.in:270
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:271)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:271
   ! pio_buf_lim_tests.F90.in:272
    rbuf = 0   ! pio_buf_lim_tests.F90.in:273
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:274
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:275)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:275
   ! pio_buf_lim_tests.F90.in:276
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:277)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:277
   ! pio_buf_lim_tests.F90.in:278
    rbuf = 0   ! pio_buf_lim_tests.F90.in:279
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:280
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:281)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:281
   ! pio_buf_lim_tests.F90.in:282
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:283)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:283
   ! pio_buf_lim_tests.F90.in:284
    ! ============ Flush every 3 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 3, iobuf_sz)   ! pio_buf_lim_tests.F90.in:286
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:287

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 3 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:288
   ! pio_buf_lim_tests.F90.in:289
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:291
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:292)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:292
   ! pio_buf_lim_tests.F90.in:293
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:294
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:295)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:295
   ! pio_buf_lim_tests.F90.in:296
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:297
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:298)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:298
   ! pio_buf_lim_tests.F90.in:299
    ! Flush for the previous 3 vars, pio_var1, pio_var2, pio_var3 should happen
    ! inside PIO_write_darray(pio_var4)
    call PIO_write_darray(pio_file, pio_var4, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:303
   ! pio_buf_lim_tests.F90.in:304
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:306
   ! pio_buf_lim_tests.F90.in:307
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:309
   ! pio_buf_lim_tests.F90.in:310
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:312
   ! pio_buf_lim_tests.F90.in:313
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:314
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:315)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:315
   ! pio_buf_lim_tests.F90.in:316
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:317
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:318)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:318
   ! pio_buf_lim_tests.F90.in:319
    ierr = PIO_inq_varid(pio_file, PIO_VAR4_NAME, pio_var4)   ! pio_buf_lim_tests.F90.in:320
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:321)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:321
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:323
#endif
   ! pio_buf_lim_tests.F90.in:325
    rbuf = 0   ! pio_buf_lim_tests.F90.in:326
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:328
   ! pio_buf_lim_tests.F90.in:329
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:330)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:330
   ! pio_buf_lim_tests.F90.in:331
    rbuf = 0   ! pio_buf_lim_tests.F90.in:332
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:333
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:334)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:334
   ! pio_buf_lim_tests.F90.in:335
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:336)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:336
   ! pio_buf_lim_tests.F90.in:337
    rbuf = 0   ! pio_buf_lim_tests.F90.in:338
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:339
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:340)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:340
   ! pio_buf_lim_tests.F90.in:341
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:342
   ! pio_buf_lim_tests.F90.in:343
    rbuf = 0   ! pio_buf_lim_tests.F90.in:344
    call PIO_read_darray(pio_file, pio_var4, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:345
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:346)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:346
   ! pio_buf_lim_tests.F90.in:347
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 4)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:348
   ! pio_buf_lim_tests.F90.in:349
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:350
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:351
  end do   ! pio_buf_lim_tests.F90.in:352
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:353
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:354
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:355
  end if   ! pio_buf_lim_tests.F90.in:356
   ! pio_buf_lim_tests.F90.in:357
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:358
END SUBROUTINE nc_wr_mvar_impl_flush_PIO_int_integer__   ! pio_buf_lim_tests.F90.in:359


SUBROUTINE nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:117
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:119
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:121
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:122
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:123
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:124
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3, pio_var4   ! pio_buf_lim_tests.F90.in:125
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:126
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:127
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:128
  character(len=*), parameter :: PIO_VAR4_NAME = 'PIO_TF_test_var4'   ! pio_buf_lim_tests.F90.in:129
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:130
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:131
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:132
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:133
  real(kind=fc_real), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:134
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:135
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:136
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:137
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:138
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:140
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:141
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:142
   ! pio_buf_lim_tests.F90.in:143
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:144
   ! pio_buf_lim_tests.F90.in:145
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:146
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:147
  end do   ! pio_buf_lim_tests.F90.in:148
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:149
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:150
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:151
   ! pio_buf_lim_tests.F90.in:152
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:153
   ! pio_buf_lim_tests.F90.in:154
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:155
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:156
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:157
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:158

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:159
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:160
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:161)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:161
   ! pio_buf_lim_tests.F90.in:162
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:163
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:164)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:164
   ! pio_buf_lim_tests.F90.in:165
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_real, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:166
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:167)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:167
   ! pio_buf_lim_tests.F90.in:168
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_real, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:169
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:170)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:170
   ! pio_buf_lim_tests.F90.in:171
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_real, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:172
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:173)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:173
   ! pio_buf_lim_tests.F90.in:174
    ierr = PIO_def_var(pio_file, PIO_VAR4_NAME, PIO_real, (/pio_dim/), pio_var4)   ! pio_buf_lim_tests.F90.in:175
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:176)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:176
   ! pio_buf_lim_tests.F90.in:177
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:178
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:179)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:179
   ! pio_buf_lim_tests.F90.in:180
    ! Set the buffer size limit such that we trigger an implicit flush
    ! on the next write. To flush every var set the buffer size limit
    ! to be slightly less than the size (local) required to cache a
    ! single variable. When the second variable is written out the first
    ! variable will be flushed out (since internal cache >= buffer size limit)
   ! pio_buf_lim_tests.F90.in:186
    ! ============ Flush every var ======================
    ! Before the 2nd variable is written out the data
    ! corresponding to the first variable will be flushed out
   ! pio_buf_lim_tests.F90.in:190
    ! Set the buffer size limit to be slightly less than required
    ! for a single variable
    call get_iobuf_sz(size(wbuf), type_sz, 1, iobuf_sz)   ! pio_buf_lim_tests.F90.in:193
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:194

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 1 var : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:195
   ! pio_buf_lim_tests.F90.in:196
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:199
   ! pio_buf_lim_tests.F90.in:200
    ! Flush for the first variable should happen inside PIO_write_darray(pio_var2)
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:202
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:203)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:203
   ! pio_buf_lim_tests.F90.in:204
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:206
   ! pio_buf_lim_tests.F90.in:207
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:208
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:209)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:209
   ! pio_buf_lim_tests.F90.in:210
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:211
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:212)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:212
   ! pio_buf_lim_tests.F90.in:213
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:214
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:215)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:215
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:217
#endif
   ! pio_buf_lim_tests.F90.in:219
    rbuf = 0   ! pio_buf_lim_tests.F90.in:220
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:221
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:222)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:222
   ! pio_buf_lim_tests.F90.in:223
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:224
   ! pio_buf_lim_tests.F90.in:225
    rbuf = 0   ! pio_buf_lim_tests.F90.in:226
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:227
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:228)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:228
   ! pio_buf_lim_tests.F90.in:229
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:230
   ! pio_buf_lim_tests.F90.in:231
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:233
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:234

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:235
   ! pio_buf_lim_tests.F90.in:236
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:238
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:239)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:239
   ! pio_buf_lim_tests.F90.in:240
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:241
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:242)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:242
   ! pio_buf_lim_tests.F90.in:243
    ! Flush for the previous 2 vars, pio_var1 and pio_var2 should happen
    ! inside PIO_write_darray(pio_var3)
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:246
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:247)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:247
   ! pio_buf_lim_tests.F90.in:248
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:250
   ! pio_buf_lim_tests.F90.in:251
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:252
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:253)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:253
   ! pio_buf_lim_tests.F90.in:254
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:255
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:256)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:256
   ! pio_buf_lim_tests.F90.in:257
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:258
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:259)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:259
   ! pio_buf_lim_tests.F90.in:260
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:261
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:262)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:262
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:264
#endif
   ! pio_buf_lim_tests.F90.in:266
    rbuf = 0   ! pio_buf_lim_tests.F90.in:267
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:268
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:269)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:269
   ! pio_buf_lim_tests.F90.in:270
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:271)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:271
   ! pio_buf_lim_tests.F90.in:272
    rbuf = 0   ! pio_buf_lim_tests.F90.in:273
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:274
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:275)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:275
   ! pio_buf_lim_tests.F90.in:276
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:277)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:277
   ! pio_buf_lim_tests.F90.in:278
    rbuf = 0   ! pio_buf_lim_tests.F90.in:279
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:280
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:281)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:281
   ! pio_buf_lim_tests.F90.in:282
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:283)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:283
   ! pio_buf_lim_tests.F90.in:284
    ! ============ Flush every 3 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 3, iobuf_sz)   ! pio_buf_lim_tests.F90.in:286
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:287

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 3 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:288
   ! pio_buf_lim_tests.F90.in:289
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:291
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:292)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:292
   ! pio_buf_lim_tests.F90.in:293
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:294
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:295)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:295
   ! pio_buf_lim_tests.F90.in:296
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:297
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:298)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:298
   ! pio_buf_lim_tests.F90.in:299
    ! Flush for the previous 3 vars, pio_var1, pio_var2, pio_var3 should happen
    ! inside PIO_write_darray(pio_var4)
    call PIO_write_darray(pio_file, pio_var4, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:303
   ! pio_buf_lim_tests.F90.in:304
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:306
   ! pio_buf_lim_tests.F90.in:307
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:309
   ! pio_buf_lim_tests.F90.in:310
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:312
   ! pio_buf_lim_tests.F90.in:313
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:314
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:315)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:315
   ! pio_buf_lim_tests.F90.in:316
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:317
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:318)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:318
   ! pio_buf_lim_tests.F90.in:319
    ierr = PIO_inq_varid(pio_file, PIO_VAR4_NAME, pio_var4)   ! pio_buf_lim_tests.F90.in:320
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:321)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:321
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:323
#endif
   ! pio_buf_lim_tests.F90.in:325
    rbuf = 0   ! pio_buf_lim_tests.F90.in:326
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:328
   ! pio_buf_lim_tests.F90.in:329
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:330)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:330
   ! pio_buf_lim_tests.F90.in:331
    rbuf = 0   ! pio_buf_lim_tests.F90.in:332
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:333
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:334)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:334
   ! pio_buf_lim_tests.F90.in:335
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:336)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:336
   ! pio_buf_lim_tests.F90.in:337
    rbuf = 0   ! pio_buf_lim_tests.F90.in:338
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:339
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:340)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:340
   ! pio_buf_lim_tests.F90.in:341
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:342
   ! pio_buf_lim_tests.F90.in:343
    rbuf = 0   ! pio_buf_lim_tests.F90.in:344
    call PIO_read_darray(pio_file, pio_var4, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:345
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:346)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:346
   ! pio_buf_lim_tests.F90.in:347
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 4)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:348
   ! pio_buf_lim_tests.F90.in:349
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:350
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:351
  end do   ! pio_buf_lim_tests.F90.in:352
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:353
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:354
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:355
  end if   ! pio_buf_lim_tests.F90.in:356
   ! pio_buf_lim_tests.F90.in:357
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:358
END SUBROUTINE nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___   ! pio_buf_lim_tests.F90.in:359


SUBROUTINE nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:117
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:119
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:121
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:122
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:123
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:124
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3, pio_var4   ! pio_buf_lim_tests.F90.in:125
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:126
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:127
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:128
  character(len=*), parameter :: PIO_VAR4_NAME = 'PIO_TF_test_var4'   ! pio_buf_lim_tests.F90.in:129
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:130
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:131
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:132
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:133
  real(kind=fc_double), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:134
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:135
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:136
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:137
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:138
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:140
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:141
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:142
   ! pio_buf_lim_tests.F90.in:143
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:144
   ! pio_buf_lim_tests.F90.in:145
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:146
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:147
  end do   ! pio_buf_lim_tests.F90.in:148
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:149
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:150
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:151
   ! pio_buf_lim_tests.F90.in:152
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:153
   ! pio_buf_lim_tests.F90.in:154
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:155
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:156
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_buf_lim_tests.F90.in:157
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:158

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:159
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:160
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:161)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:161
   ! pio_buf_lim_tests.F90.in:162
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:163
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:164)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:164
   ! pio_buf_lim_tests.F90.in:165
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_double, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:166
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:167)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:167
   ! pio_buf_lim_tests.F90.in:168
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_double, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:169
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:170)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:170
   ! pio_buf_lim_tests.F90.in:171
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_double, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:172
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:173)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:173
   ! pio_buf_lim_tests.F90.in:174
    ierr = PIO_def_var(pio_file, PIO_VAR4_NAME, PIO_double, (/pio_dim/), pio_var4)   ! pio_buf_lim_tests.F90.in:175
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:176)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:176
   ! pio_buf_lim_tests.F90.in:177
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:178
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:179)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:179
   ! pio_buf_lim_tests.F90.in:180
    ! Set the buffer size limit such that we trigger an implicit flush
    ! on the next write. To flush every var set the buffer size limit
    ! to be slightly less than the size (local) required to cache a
    ! single variable. When the second variable is written out the first
    ! variable will be flushed out (since internal cache >= buffer size limit)
   ! pio_buf_lim_tests.F90.in:186
    ! ============ Flush every var ======================
    ! Before the 2nd variable is written out the data
    ! corresponding to the first variable will be flushed out
   ! pio_buf_lim_tests.F90.in:190
    ! Set the buffer size limit to be slightly less than required
    ! for a single variable
    call get_iobuf_sz(size(wbuf), type_sz, 1, iobuf_sz)   ! pio_buf_lim_tests.F90.in:193
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:194

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 1 var : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:195
   ! pio_buf_lim_tests.F90.in:196
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:198
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:199)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:199
   ! pio_buf_lim_tests.F90.in:200
    ! Flush for the first variable should happen inside PIO_write_darray(pio_var2)
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:202
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:203)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:203
   ! pio_buf_lim_tests.F90.in:204
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:206
   ! pio_buf_lim_tests.F90.in:207
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:208
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:209)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:209
   ! pio_buf_lim_tests.F90.in:210
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:211
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:212)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:212
   ! pio_buf_lim_tests.F90.in:213
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:214
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:215)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:215
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:217
#endif
   ! pio_buf_lim_tests.F90.in:219
    rbuf = 0   ! pio_buf_lim_tests.F90.in:220
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:221
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:222)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:222
   ! pio_buf_lim_tests.F90.in:223
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:224
   ! pio_buf_lim_tests.F90.in:225
    rbuf = 0   ! pio_buf_lim_tests.F90.in:226
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:227
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:228)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:228
   ! pio_buf_lim_tests.F90.in:229
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:230
   ! pio_buf_lim_tests.F90.in:231
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:233
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:234

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:235
   ! pio_buf_lim_tests.F90.in:236
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:238
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:239)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:239
   ! pio_buf_lim_tests.F90.in:240
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:241
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:242)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:242
   ! pio_buf_lim_tests.F90.in:243
    ! Flush for the previous 2 vars, pio_var1 and pio_var2 should happen
    ! inside PIO_write_darray(pio_var3)
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:246
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:247)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:247
   ! pio_buf_lim_tests.F90.in:248
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:250
   ! pio_buf_lim_tests.F90.in:251
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:252
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:253)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:253
   ! pio_buf_lim_tests.F90.in:254
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:255
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:256)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:256
   ! pio_buf_lim_tests.F90.in:257
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:258
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:259)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:259
   ! pio_buf_lim_tests.F90.in:260
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:261
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:262)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:262
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:264
#endif
   ! pio_buf_lim_tests.F90.in:266
    rbuf = 0   ! pio_buf_lim_tests.F90.in:267
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:268
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:269)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:269
   ! pio_buf_lim_tests.F90.in:270
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:271)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:271
   ! pio_buf_lim_tests.F90.in:272
    rbuf = 0   ! pio_buf_lim_tests.F90.in:273
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:274
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:275)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:275
   ! pio_buf_lim_tests.F90.in:276
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:277)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:277
   ! pio_buf_lim_tests.F90.in:278
    rbuf = 0   ! pio_buf_lim_tests.F90.in:279
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:280
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:281)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:281
   ! pio_buf_lim_tests.F90.in:282
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:283)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:283
   ! pio_buf_lim_tests.F90.in:284
    ! ============ Flush every 3 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 3, iobuf_sz)   ! pio_buf_lim_tests.F90.in:286
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:287

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 3 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:288
   ! pio_buf_lim_tests.F90.in:289
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:291
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:292)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:292
   ! pio_buf_lim_tests.F90.in:293
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:294
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:295)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:295
   ! pio_buf_lim_tests.F90.in:296
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:297
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:298)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:298
   ! pio_buf_lim_tests.F90.in:299
    ! Flush for the previous 3 vars, pio_var1, pio_var2, pio_var3 should happen
    ! inside PIO_write_darray(pio_var4)
    call PIO_write_darray(pio_file, pio_var4, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:302
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:303)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:303
   ! pio_buf_lim_tests.F90.in:304
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:306
   ! pio_buf_lim_tests.F90.in:307
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:308
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:309)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:309
   ! pio_buf_lim_tests.F90.in:310
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:311
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:312)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:312
   ! pio_buf_lim_tests.F90.in:313
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:314
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:315)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:315
   ! pio_buf_lim_tests.F90.in:316
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:317
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:318)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:318
   ! pio_buf_lim_tests.F90.in:319
    ierr = PIO_inq_varid(pio_file, PIO_VAR4_NAME, pio_var4)   ! pio_buf_lim_tests.F90.in:320
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var4 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:321)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:321
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:323
#endif
   ! pio_buf_lim_tests.F90.in:325
    rbuf = 0   ! pio_buf_lim_tests.F90.in:326
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:327
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:328)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:328
   ! pio_buf_lim_tests.F90.in:329
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:330)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:330
   ! pio_buf_lim_tests.F90.in:331
    rbuf = 0   ! pio_buf_lim_tests.F90.in:332
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:333
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:334)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:334
   ! pio_buf_lim_tests.F90.in:335
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:336)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:336
   ! pio_buf_lim_tests.F90.in:337
    rbuf = 0   ! pio_buf_lim_tests.F90.in:338
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:339
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:340)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:340
   ! pio_buf_lim_tests.F90.in:341
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:342
   ! pio_buf_lim_tests.F90.in:343
    rbuf = 0   ! pio_buf_lim_tests.F90.in:344
    call PIO_read_darray(pio_file, pio_var4, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:345
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var4) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:346)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:346
   ! pio_buf_lim_tests.F90.in:347
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 4)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:348
   ! pio_buf_lim_tests.F90.in:349
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:350
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:351
  end do   ! pio_buf_lim_tests.F90.in:352
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:353
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:354
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:355
  end if   ! pio_buf_lim_tests.F90.in:356
   ! pio_buf_lim_tests.F90.in:357
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:358
END SUBROUTINE nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___   ! pio_buf_lim_tests.F90.in:359
   ! pio_buf_lim_tests.F90.in:359


! Test that writes out two variables with implicit flush. Then
! a third variable is written out (after the implicit flush).
! The data corresponding to the third variable is only synced
! when PIO_syncfile() is called (explicit flush).


SUBROUTINE nc_wr_after_impl_flush_PIO_int_integer__
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:366
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:368
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:370
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:371
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:372
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:373
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3   ! pio_buf_lim_tests.F90.in:374
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:375
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:376
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:377
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:378
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:379
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:380
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:381
  integer, dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:382
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:383
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:384
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:385
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:386
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:388
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:389
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:390
   ! pio_buf_lim_tests.F90.in:391
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:392
   ! pio_buf_lim_tests.F90.in:393
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:394
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:395
  end do   ! pio_buf_lim_tests.F90.in:396
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:397
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:398
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:399
   ! pio_buf_lim_tests.F90.in:400
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:401
   ! pio_buf_lim_tests.F90.in:402
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:403
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:404
  filename = "test_pio_wr_aftr_impl_flush_tests.testfile"   ! pio_buf_lim_tests.F90.in:405
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:406

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:407
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:408
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:409)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:409
   ! pio_buf_lim_tests.F90.in:410
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:411
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:412)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:412
   ! pio_buf_lim_tests.F90.in:413
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_int, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:414
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:415)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:415
   ! pio_buf_lim_tests.F90.in:416
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_int, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:417
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:418)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:418
   ! pio_buf_lim_tests.F90.in:419
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_int, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:420
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:421)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:421
   ! pio_buf_lim_tests.F90.in:422
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:423
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:424)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:424
   ! pio_buf_lim_tests.F90.in:425
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:427
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:428

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:429
   ! pio_buf_lim_tests.F90.in:430
    ! Write two variables
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:432
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:433)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:433
   ! pio_buf_lim_tests.F90.in:434
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:435
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:436)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:436
   ! pio_buf_lim_tests.F90.in:437
    ! The implicit flush should happen for the previous
    ! two variables inside the next PIO_write_darray() call
    !
    ! Write out another variable, the data for pio_var3 is not
    ! flushed out until we explicitly sync/close
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:443
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:444)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:444
   ! pio_buf_lim_tests.F90.in:445
    ! Sync data for all three variables (only results in explicit
    ! flush of data corresponding to pio_var3, the third variable)
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:449
   ! pio_buf_lim_tests.F90.in:450
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:451
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:452)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:452
   ! pio_buf_lim_tests.F90.in:453
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:454
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:455)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:455
   ! pio_buf_lim_tests.F90.in:456
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:457
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:458)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:458
   ! pio_buf_lim_tests.F90.in:459
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:460
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:461)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:461
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:463
#endif
   ! pio_buf_lim_tests.F90.in:465
    rbuf = 0   ! pio_buf_lim_tests.F90.in:466
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:467
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:468)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:468
   ! pio_buf_lim_tests.F90.in:469
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:470)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:470
   ! pio_buf_lim_tests.F90.in:471
    rbuf = 0   ! pio_buf_lim_tests.F90.in:472
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:473
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:474)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:474
   ! pio_buf_lim_tests.F90.in:475
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:476)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:476
   ! pio_buf_lim_tests.F90.in:477
    rbuf = 0   ! pio_buf_lim_tests.F90.in:478
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:479
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:480)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:480
   ! pio_buf_lim_tests.F90.in:481
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:482
   ! pio_buf_lim_tests.F90.in:483
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:484
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:485
  end do   ! pio_buf_lim_tests.F90.in:486
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:487
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:488
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:489
  end if   ! pio_buf_lim_tests.F90.in:490
   ! pio_buf_lim_tests.F90.in:491
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:492
END SUBROUTINE nc_wr_after_impl_flush_PIO_int_integer__   ! pio_buf_lim_tests.F90.in:493


SUBROUTINE nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:366
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:368
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:370
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:371
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:372
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:373
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3   ! pio_buf_lim_tests.F90.in:374
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:375
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:376
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:377
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:378
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:379
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:380
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:381
  real(kind=fc_real), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:382
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:383
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:384
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:385
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:386
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:388
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:389
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:390
   ! pio_buf_lim_tests.F90.in:391
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:392
   ! pio_buf_lim_tests.F90.in:393
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:394
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:395
  end do   ! pio_buf_lim_tests.F90.in:396
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:397
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:398
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:399
   ! pio_buf_lim_tests.F90.in:400
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:401
   ! pio_buf_lim_tests.F90.in:402
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:403
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:404
  filename = "test_pio_wr_aftr_impl_flush_tests.testfile"   ! pio_buf_lim_tests.F90.in:405
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:406

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:407
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:408
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:409)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:409
   ! pio_buf_lim_tests.F90.in:410
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:411
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:412)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:412
   ! pio_buf_lim_tests.F90.in:413
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_real, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:414
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:415)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:415
   ! pio_buf_lim_tests.F90.in:416
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_real, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:417
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:418)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:418
   ! pio_buf_lim_tests.F90.in:419
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_real, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:420
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:421)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:421
   ! pio_buf_lim_tests.F90.in:422
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:423
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:424)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:424
   ! pio_buf_lim_tests.F90.in:425
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:427
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:428

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:429
   ! pio_buf_lim_tests.F90.in:430
    ! Write two variables
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:432
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:433)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:433
   ! pio_buf_lim_tests.F90.in:434
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:435
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:436)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:436
   ! pio_buf_lim_tests.F90.in:437
    ! The implicit flush should happen for the previous
    ! two variables inside the next PIO_write_darray() call
    !
    ! Write out another variable, the data for pio_var3 is not
    ! flushed out until we explicitly sync/close
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:443
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:444)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:444
   ! pio_buf_lim_tests.F90.in:445
    ! Sync data for all three variables (only results in explicit
    ! flush of data corresponding to pio_var3, the third variable)
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:449
   ! pio_buf_lim_tests.F90.in:450
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:451
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:452)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:452
   ! pio_buf_lim_tests.F90.in:453
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:454
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:455)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:455
   ! pio_buf_lim_tests.F90.in:456
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:457
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:458)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:458
   ! pio_buf_lim_tests.F90.in:459
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:460
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:461)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:461
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:463
#endif
   ! pio_buf_lim_tests.F90.in:465
    rbuf = 0   ! pio_buf_lim_tests.F90.in:466
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:467
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:468)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:468
   ! pio_buf_lim_tests.F90.in:469
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:470)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:470
   ! pio_buf_lim_tests.F90.in:471
    rbuf = 0   ! pio_buf_lim_tests.F90.in:472
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:473
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:474)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:474
   ! pio_buf_lim_tests.F90.in:475
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:476)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:476
   ! pio_buf_lim_tests.F90.in:477
    rbuf = 0   ! pio_buf_lim_tests.F90.in:478
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:479
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:480)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:480
   ! pio_buf_lim_tests.F90.in:481
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:482
   ! pio_buf_lim_tests.F90.in:483
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:484
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:485
  end do   ! pio_buf_lim_tests.F90.in:486
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:487
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:488
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:489
  end if   ! pio_buf_lim_tests.F90.in:490
   ! pio_buf_lim_tests.F90.in:491
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:492
END SUBROUTINE nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___   ! pio_buf_lim_tests.F90.in:493


SUBROUTINE nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_buf_lim_tests.F90.in:366
#ifndef NO_C_SIZEOF
  use iso_c_binding, only : C_SIZEOF   ! pio_buf_lim_tests.F90.in:368
#endif
  implicit none   ! pio_buf_lim_tests.F90.in:370
  integer, parameter :: VEC_LOCAL_SZ = 7   ! pio_buf_lim_tests.F90.in:371
  integer(kind=pio_offset_kind) :: iobuf_sz   ! pio_buf_lim_tests.F90.in:372
  integer :: type_sz   ! pio_buf_lim_tests.F90.in:373
  type(var_desc_t)  :: pio_var1, pio_var2, pio_var3   ! pio_buf_lim_tests.F90.in:374
  character(len=*), parameter :: PIO_VAR1_NAME = 'PIO_TF_test_var1'   ! pio_buf_lim_tests.F90.in:375
  character(len=*), parameter :: PIO_VAR2_NAME = 'PIO_TF_test_var2'   ! pio_buf_lim_tests.F90.in:376
  character(len=*), parameter :: PIO_VAR3_NAME = 'PIO_TF_test_var3'   ! pio_buf_lim_tests.F90.in:377
  type(file_desc_t) :: pio_file   ! pio_buf_lim_tests.F90.in:378
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_buf_lim_tests.F90.in:379
  type(io_desc_t) :: iodesc   ! pio_buf_lim_tests.F90.in:380
  integer, dimension(VEC_LOCAL_SZ) :: compdof, compdof_rel_disps   ! pio_buf_lim_tests.F90.in:381
  real(kind=fc_double), dimension(VEC_LOCAL_SZ) :: wbuf, rbuf   ! pio_buf_lim_tests.F90.in:382
  byte, dimension(VEC_LOCAL_SZ) :: bbuf   ! pio_buf_lim_tests.F90.in:383
  integer, dimension(1) :: dims   ! pio_buf_lim_tests.F90.in:384
  integer :: pio_dim   ! pio_buf_lim_tests.F90.in:385
  integer :: i, ierr, lsz   ! pio_buf_lim_tests.F90.in:386
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_buf_lim_tests.F90.in:388
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_buf_lim_tests.F90.in:389
  integer :: num_iotypes   ! pio_buf_lim_tests.F90.in:390
   ! pio_buf_lim_tests.F90.in:391
  type_sz = TYPE_SIZEOF(wbuf)   ! pio_buf_lim_tests.F90.in:392
   ! pio_buf_lim_tests.F90.in:393
  do i=1,VEC_LOCAL_SZ   ! pio_buf_lim_tests.F90.in:394
    compdof_rel_disps(i) = i   ! pio_buf_lim_tests.F90.in:395
  end do   ! pio_buf_lim_tests.F90.in:396
  dims(1) = VEC_LOCAL_SZ * pio_tf_world_sz_   ! pio_buf_lim_tests.F90.in:397
  compdof = VEC_LOCAL_SZ * pio_tf_world_rank_ + compdof_rel_disps   ! pio_buf_lim_tests.F90.in:398
  wbuf = pio_tf_world_rank_;   ! pio_buf_lim_tests.F90.in:399
   ! pio_buf_lim_tests.F90.in:400
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, iodesc)   ! pio_buf_lim_tests.F90.in:401
   ! pio_buf_lim_tests.F90.in:402
  num_iotypes = 0   ! pio_buf_lim_tests.F90.in:403
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_buf_lim_tests.F90.in:404
  filename = "test_pio_wr_aftr_impl_flush_tests.testfile"   ! pio_buf_lim_tests.F90.in:405
  do i=1,num_iotypes   ! pio_buf_lim_tests.F90.in:406

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:407
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_buf_lim_tests.F90.in:408
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:409)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:409
   ! pio_buf_lim_tests.F90.in:410
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim', dims(1), pio_dim)   ! pio_buf_lim_tests.F90.in:411
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:412)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:412
   ! pio_buf_lim_tests.F90.in:413
    ierr = PIO_def_var(pio_file, PIO_VAR1_NAME, PIO_double, (/pio_dim/), pio_var1)   ! pio_buf_lim_tests.F90.in:414
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:415)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:415
   ! pio_buf_lim_tests.F90.in:416
    ierr = PIO_def_var(pio_file, PIO_VAR2_NAME, PIO_double, (/pio_dim/), pio_var2)   ! pio_buf_lim_tests.F90.in:417
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:418)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:418
   ! pio_buf_lim_tests.F90.in:419
    ierr = PIO_def_var(pio_file, PIO_VAR3_NAME, PIO_double, (/pio_dim/), pio_var3)   ! pio_buf_lim_tests.F90.in:420
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:421)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:421
   ! pio_buf_lim_tests.F90.in:422
    ierr = PIO_enddef(pio_file)   ! pio_buf_lim_tests.F90.in:423
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:424)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:424
   ! pio_buf_lim_tests.F90.in:425
    ! ============ Flush every 2 vars ======================
    call get_iobuf_sz(size(wbuf), type_sz, 2, iobuf_sz)   ! pio_buf_lim_tests.F90.in:427
    call PIO_set_buffer_size_limit(iobuf_sz)   ! pio_buf_lim_tests.F90.in:428

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : Flush every 2 vars : buffer limit = ", iobuf_sz
      END IF
    END IF   ! pio_buf_lim_tests.F90.in:429
   ! pio_buf_lim_tests.F90.in:430
    ! Write two variables
    call PIO_write_darray(pio_file, pio_var1, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:432
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:433)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:433
   ! pio_buf_lim_tests.F90.in:434
    call PIO_write_darray(pio_file, pio_var2, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:435
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:436)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:436
   ! pio_buf_lim_tests.F90.in:437
    ! The implicit flush should happen for the previous
    ! two variables inside the next PIO_write_darray() call
    !
    ! Write out another variable, the data for pio_var3 is not
    ! flushed out until we explicitly sync/close
    call PIO_write_darray(pio_file, pio_var3, iodesc, wbuf, ierr)   ! pio_buf_lim_tests.F90.in:443
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:444)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:444
   ! pio_buf_lim_tests.F90.in:445
    ! Sync data for all three variables (only results in explicit
    ! flush of data corresponding to pio_var3, the third variable)
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:449
   ! pio_buf_lim_tests.F90.in:450
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_write)   ! pio_buf_lim_tests.F90.in:451
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:452)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:452
   ! pio_buf_lim_tests.F90.in:453
    ierr = PIO_inq_varid(pio_file, PIO_VAR1_NAME, pio_var1)   ! pio_buf_lim_tests.F90.in:454
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var1 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:455)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:455
   ! pio_buf_lim_tests.F90.in:456
    ierr = PIO_inq_varid(pio_file, PIO_VAR2_NAME, pio_var2)   ! pio_buf_lim_tests.F90.in:457
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var2 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:458)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:458
   ! pio_buf_lim_tests.F90.in:459
    ierr = PIO_inq_varid(pio_file, PIO_VAR3_NAME, pio_var3)   ! pio_buf_lim_tests.F90.in:460
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var3 : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:461)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:461
#else
    call PIO_syncfile(pio_file)   ! pio_buf_lim_tests.F90.in:463
#endif
   ! pio_buf_lim_tests.F90.in:465
    rbuf = 0   ! pio_buf_lim_tests.F90.in:466
    call PIO_read_darray(pio_file, pio_var1, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:467
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var1) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:468)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:468
   ! pio_buf_lim_tests.F90.in:469
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 1)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:470)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:470
   ! pio_buf_lim_tests.F90.in:471
    rbuf = 0   ! pio_buf_lim_tests.F90.in:472
    call PIO_read_darray(pio_file, pio_var2, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:473
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var2) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:474)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:474
   ! pio_buf_lim_tests.F90.in:475
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 2)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:476)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:476
   ! pio_buf_lim_tests.F90.in:477
    rbuf = 0   ! pio_buf_lim_tests.F90.in:478
    call PIO_read_darray(pio_file, pio_var3, iodesc, rbuf, ierr)   ! pio_buf_lim_tests.F90.in:479
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray(var3) : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:480)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:480
   ! pio_buf_lim_tests.F90.in:481
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, wbuf)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val (var 3)",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_buf_lim_tests.F90.in:482)"
      END IF
      RETURN
    END IF   ! pio_buf_lim_tests.F90.in:482
   ! pio_buf_lim_tests.F90.in:483
    call PIO_closefile(pio_file)   ! pio_buf_lim_tests.F90.in:484
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_buf_lim_tests.F90.in:485
  end do   ! pio_buf_lim_tests.F90.in:486
  if(allocated(iotypes)) then   ! pio_buf_lim_tests.F90.in:487
    deallocate(iotypes)   ! pio_buf_lim_tests.F90.in:488
    deallocate(iotype_descs)   ! pio_buf_lim_tests.F90.in:489
  end if   ! pio_buf_lim_tests.F90.in:490
   ! pio_buf_lim_tests.F90.in:491
  call PIO_freedecomp(pio_tf_iosystem_, iodesc)   ! pio_buf_lim_tests.F90.in:492
END SUBROUTINE nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___   ! pio_buf_lim_tests.F90.in:493
   ! pio_buf_lim_tests.F90.in:493


  SUBROUTINE PIO_TF_Test_driver_
    USE pio_tutil
    IMPLICIT NONE
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_int_integer__"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_int_integer__"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_int_integer__"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_wr_mvar_impl_flush_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_wr_mvar_impl_flush_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_int_integer__"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 10:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 10:",&
          "nc_wr_buf_limit_zero_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 11:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 11:",&
          "nc_wr_buf_limit_zero_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 12:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 12:",&
          "nc_wr_buf_limit_zero_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_int_integer__"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 13:",&
          "nc_wr_mvar_impl_flush_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 13:",&
          "nc_wr_mvar_impl_flush_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 14:",&
          "nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 14:",&
          "nc_wr_mvar_impl_flush_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 15:",&
          "nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 15:",&
          "nc_wr_mvar_impl_flush_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_after_impl_flush_PIO_int_integer__"
    END IF
    CALL nc_wr_after_impl_flush_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 16:",&
          "nc_wr_after_impl_flush_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 16:",&
          "nc_wr_after_impl_flush_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 17:",&
          "nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 17:",&
          "nc_wr_after_impl_flush_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 18:",&
          "nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 18:",&
          "nc_wr_after_impl_flush_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
  END SUBROUTINE PIO_TF_Test_driver_


  PROGRAM PIO_TF_Test_main_
    USE pio_tutil
    IMPLICIT NONE
    INTEGER, PARAMETER :: NREARRS = 2
    INTEGER :: rearrs(NREARRS) = (/pio_rearr_subset,pio_rearr_box/)
    CHARACTER(LEN=PIO_TF_MAX_STR_LEN) :: rearrs_info(NREARRS) = (/"PIO_REARR_SUBSET","PIO_REARR_BOX   "/)
    INTEGER i, ierr

    pio_tf_nerrs_total_=0
    pio_tf_retval_utest_=0
    CALL MPI_Init(ierr)
    DO i=1,SIZE(rearrs)
      CALL PIO_TF_Init_(rearrs(i))
      IF (pio_tf_world_rank_ == 0) THEN
        WRITE(*,*) "PIO_TF: Testing : ", trim(rearrs_info(i))
      END IF
      CALL PIO_TF_Test_driver_()
      CALL PIO_TF_Finalize_()
    END DO
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_nerrs_total_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "All tests", "---------", "PASSED"
        ELSE
          pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "Test driver", "---------", "FAILED"
        END IF
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT2) "PIO_TF:[",&
          pio_tf_nerrs_total_,"] Tests",&
          "----- FAILED"
      END IF
    END IF
    CALL MPI_Finalize(ierr)
    IF (pio_tf_nerrs_total_ /= 0) THEN
      STOP 99
    END IF
  END PROGRAM
