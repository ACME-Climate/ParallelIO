! DON'T MODIFY THIS FILE, ALL YOUR CHANGES WILL BE LOST
! This file is generated by ../../../tests/general/util/pio_tf_f90gen.pl
! from /home/tkurc/codar/e3sm/pio_adios1/ParallelIO/tests/general/pio_decomp_tests_2d.F90.in

! Get a 2D column decomposition
! If force_rearrange is FALSE, the decomposition is such that
! # All even procs have VEC_COL_SZ rows of VEC_ROW_SZ elements
! # All odd procs have  VEC_COL_SZ rows of VEC_ROW_SZ + 1 elements
! e.g. For VEC_ROW_SZ = 2, VEC_COL_SZ = 2 and ranks 0, 1, 2,
! e.g. 1) |(1,1) (1,2)|  |(1,3) (1,4) (1,5)|  |(1,6) (1,7)|
!         |(2,1) (2,2)|, |(2,3) (2,4) (2,5)|, |(2,6) (2,7)|
! If force_rearrange is TRUE, the decomposition is such that,
! If possible, the even rank "exchanges" elements with the next
! higher ranked odd proc.
! This for example can be used to force rearrangement when reading
! or writing data.
! e.g. For VEC_ROW_SZ = 2, VEC_COL_SZ = 2 and ranks 0, 1, 2
! e.g. 1) |(1,3) (1,4) (1,5)|  |(1,1) (1,2)|   |(1,6) (1,7)|
!         |(2,3) (2,4) (2,5)|, |(2,1) (2,2)|,  |(2,6) (2,7)|
SUBROUTINE get_2d_col_decomp_info(rank, sz, dims, start, count, force_rearrange)   ! pio_decomp_tests_2d.F90.in:16
  integer, parameter :: VEC_ROW_SZ = 7   ! pio_decomp_tests_2d.F90.in:17
  integer, parameter :: VEC_COL_SZ = 7   ! pio_decomp_tests_2d.F90.in:18
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:19
  integer, intent(in) :: rank   ! pio_decomp_tests_2d.F90.in:20
  integer, intent(in) :: sz   ! pio_decomp_tests_2d.F90.in:21
  integer, dimension(NDIMS), intent(out) :: dims   ! pio_decomp_tests_2d.F90.in:22
  integer, dimension(NDIMS), intent(out) :: start   ! pio_decomp_tests_2d.F90.in:23
  integer, dimension(NDIMS), intent(out) :: count   ! pio_decomp_tests_2d.F90.in:24
  logical, intent(in) :: force_rearrange   ! pio_decomp_tests_2d.F90.in:25


  logical :: is_even_rank   ! pio_decomp_tests_2d.F90.in:27
  integer :: num_odd_procs, num_even_procs   ! pio_decomp_tests_2d.F90.in:28
  integer :: iodd, ieven   ! pio_decomp_tests_2d.F90.in:29


  is_even_rank = .false.   ! pio_decomp_tests_2d.F90.in:31
  if (mod(rank, 2) == 0) then   ! pio_decomp_tests_2d.F90.in:32
    is_even_rank = .true.   ! pio_decomp_tests_2d.F90.in:33
  end if   ! pio_decomp_tests_2d.F90.in:34
  num_odd_procs = sz / 2   ! pio_decomp_tests_2d.F90.in:35
  num_even_procs = sz - num_odd_procs   ! pio_decomp_tests_2d.F90.in:36
  dims(1) = VEC_COL_SZ   ! pio_decomp_tests_2d.F90.in:37
  dims(2) = num_even_procs * VEC_ROW_SZ + num_odd_procs * (VEC_ROW_SZ + 1)   ! pio_decomp_tests_2d.F90.in:38
  ! Number of odd and even procs before this rank
  iodd = rank / 2   ! pio_decomp_tests_2d.F90.in:40
  ieven = (rank + 1) / 2   ! pio_decomp_tests_2d.F90.in:41


  ! Rows
  start(1) = 1   ! pio_decomp_tests_2d.F90.in:44
  count(1) = VEC_COL_SZ   ! pio_decomp_tests_2d.F90.in:45


  ! Columns
  if(force_rearrange) then   ! pio_decomp_tests_2d.F90.in:48
    ! Make sure that we force rearrangement
    if (is_even_rank) then   ! pio_decomp_tests_2d.F90.in:50
      if(rank + 1 < sz) then   ! pio_decomp_tests_2d.F90.in:51
        ! Force rearrangement
        count(2) = VEC_ROW_SZ + 1   ! pio_decomp_tests_2d.F90.in:53
        start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + (VEC_ROW_SZ) + 1   ! pio_decomp_tests_2d.F90.in:54
      else   ! pio_decomp_tests_2d.F90.in:55
        count(2) = VEC_ROW_SZ   ! pio_decomp_tests_2d.F90.in:56
        start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + 1   ! pio_decomp_tests_2d.F90.in:57
      end if   ! pio_decomp_tests_2d.F90.in:58
    else   ! pio_decomp_tests_2d.F90.in:59
      ! For all odd procs there is an even lower ranked, rank-1, proc
      ! So force rearrangement
      count(2) = VEC_ROW_SZ   ! pio_decomp_tests_2d.F90.in:62
      start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) - (VEC_ROW_SZ) + 1   ! pio_decomp_tests_2d.F90.in:63
    end if   ! pio_decomp_tests_2d.F90.in:64
  else   ! pio_decomp_tests_2d.F90.in:65
    if (is_even_rank) then   ! pio_decomp_tests_2d.F90.in:66
      count(2) = VEC_ROW_SZ   ! pio_decomp_tests_2d.F90.in:67
    else   ! pio_decomp_tests_2d.F90.in:68
      count(2) = VEC_ROW_SZ + 1   ! pio_decomp_tests_2d.F90.in:69
    end if   ! pio_decomp_tests_2d.F90.in:70
    start(2) = ieven * VEC_ROW_SZ + iodd * (VEC_ROW_SZ + 1) + 1   ! pio_decomp_tests_2d.F90.in:71
  end if   ! pio_decomp_tests_2d.F90.in:72


END SUBROUTINE   ! pio_decomp_tests_2d.F90.in:74


! Get a 2D row decomposition
! If force_rearrange is FALSE, the decomposition is such that
! # All even procs have VEC_COL_SZ rows of VEC_ROW_SZ elements
! # All odd procs have  VEC_COL_SZ+1 rows of VEC_ROW_SZ elements
! e.g. For VEC_ROW_SZ = 6, VEC_COL_SZ = 1 and ranks 0, 1, 2,
! e.g. 1) |(1,1) (1,2) (1,3) (1,4) (1,5) (1,6)|,
!         |(2,1) (2,2) (2,3) (2,4) (2,5) (2,6)|
!         |(3,1) (3,2) (3,3) (3,4) (3,5) (3,6)|,
!         |(4,1) (4,2) (4,3) (4,4) (4,5) (4,6)|
! If force_rearrange is TRUE, the decomposition is such that,
! If possible, the even rank "exchanges" elements (rows) with the next
! higher ranked odd proc.
! This for example can be used to force rearrangement when reading
! or writing data.
! e.g. For VEC_ROW_SZ = 6, VEC_COL_SZ = 1 and ranks 0, 1, 2
! e.g. 1) |(2,1) (2,2) (2,3) (2,4) (2,5) (2,6)|
!         |(3,1) (3,2) (3,3) (3,4) (3,5) (3,6)|,
!         |(1,1) (1,2) (1,3) (1,4) (1,5) (1,6)|,
!         |(4,1) (4,2) (4,3) (4,4) (4,5) (4,6)|
SUBROUTINE get_2d_row_decomp_info(rank, sz, dims, start, count, force_rearrange)   ! pio_decomp_tests_2d.F90.in:95
  integer, parameter :: VEC_COL_SZ = 7   ! pio_decomp_tests_2d.F90.in:96
  integer, parameter :: VEC_ROW_SZ = 7   ! pio_decomp_tests_2d.F90.in:97
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:98
  integer, intent(in) :: rank   ! pio_decomp_tests_2d.F90.in:99
  integer, intent(in) :: sz   ! pio_decomp_tests_2d.F90.in:100
  integer, dimension(NDIMS), intent(out) :: dims   ! pio_decomp_tests_2d.F90.in:101
  integer, dimension(NDIMS), intent(out) :: start   ! pio_decomp_tests_2d.F90.in:102
  integer, dimension(NDIMS), intent(out) :: count   ! pio_decomp_tests_2d.F90.in:103
  logical, intent(in) :: force_rearrange   ! pio_decomp_tests_2d.F90.in:104


  logical :: is_even_rank   ! pio_decomp_tests_2d.F90.in:106
  integer :: num_odd_procs, num_even_procs   ! pio_decomp_tests_2d.F90.in:107
  integer :: iodd, ieven   ! pio_decomp_tests_2d.F90.in:108


  is_even_rank = .false.   ! pio_decomp_tests_2d.F90.in:110
  if (mod(rank, 2) == 0) then   ! pio_decomp_tests_2d.F90.in:111
    is_even_rank = .true.   ! pio_decomp_tests_2d.F90.in:112
  end if   ! pio_decomp_tests_2d.F90.in:113
  num_odd_procs = sz / 2   ! pio_decomp_tests_2d.F90.in:114
  num_even_procs = sz - num_odd_procs   ! pio_decomp_tests_2d.F90.in:115
  dims(1) = num_even_procs * VEC_COL_SZ + num_odd_procs * (VEC_COL_SZ + 1)   ! pio_decomp_tests_2d.F90.in:116
  dims(2) = VEC_ROW_SZ   ! pio_decomp_tests_2d.F90.in:117
  ! Number of odd and even procs before this rank
  iodd = rank / 2   ! pio_decomp_tests_2d.F90.in:119
  ieven = (rank + 1) / 2   ! pio_decomp_tests_2d.F90.in:120


  ! Rows
  if(force_rearrange) then   ! pio_decomp_tests_2d.F90.in:123
    ! Make sure that we force rearrangement
    if (is_even_rank) then   ! pio_decomp_tests_2d.F90.in:125
      if(rank + 1 < sz) then   ! pio_decomp_tests_2d.F90.in:126
        ! Force rearrangement
        count(1) = VEC_COL_SZ + 1   ! pio_decomp_tests_2d.F90.in:128
        start(1) = ieven * VEC_COL_SZ + iodd * (VEC_COL_SZ + 1) + (VEC_COL_SZ) + 1   ! pio_decomp_tests_2d.F90.in:129
      else   ! pio_decomp_tests_2d.F90.in:130
        count(1) = VEC_COL_SZ   ! pio_decomp_tests_2d.F90.in:131
        start(1) = ieven * VEC_COL_SZ + iodd * (VEC_COL_SZ + 1) + 1   ! pio_decomp_tests_2d.F90.in:132
      end if   ! pio_decomp_tests_2d.F90.in:133
    else   ! pio_decomp_tests_2d.F90.in:134
      ! For all odd procs there is an even lower ranked, rank-1, proc
      ! So force rearrangement
      count(1) = VEC_COL_SZ   ! pio_decomp_tests_2d.F90.in:137
      start(1) = ieven * VEC_COL_SZ + iodd * (VEC_COL_SZ + 1) - (VEC_COL_SZ) + 1   ! pio_decomp_tests_2d.F90.in:138
    end if   ! pio_decomp_tests_2d.F90.in:139
  else   ! pio_decomp_tests_2d.F90.in:140
    if (is_even_rank) then   ! pio_decomp_tests_2d.F90.in:141
      count(1) = VEC_COL_SZ   ! pio_decomp_tests_2d.F90.in:142
    else   ! pio_decomp_tests_2d.F90.in:143
      count(1) = VEC_COL_SZ + 1   ! pio_decomp_tests_2d.F90.in:144
    end if   ! pio_decomp_tests_2d.F90.in:145
    start(1) = ieven * VEC_COL_SZ + iodd * (VEC_COL_SZ + 1) + 1   ! pio_decomp_tests_2d.F90.in:146
  end if   ! pio_decomp_tests_2d.F90.in:147


  ! Columns
  start(2) = 1   ! pio_decomp_tests_2d.F90.in:150
  count(2) = VEC_ROW_SZ   ! pio_decomp_tests_2d.F90.in:151


END SUBROUTINE   ! pio_decomp_tests_2d.F90.in:153


! Write with one decomp (to force rearrangement) and read with another (no
! rearrangement)


SUBROUTINE nc_write_read_2d_col_decomp_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:158
  implicit none   ! pio_decomp_tests_2d.F90.in:159
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:160
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:161
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:162
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:163
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:164
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:165
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:166
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:167
  integer, dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:168
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:169
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:170
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:171
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:173
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:174
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:175
   ! pio_decomp_tests_2d.F90.in:176
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:178
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:179
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:180
     ! pio_decomp_tests_2d.F90.in:181
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:182
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:183
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:184
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:185
      wbuf(i,j) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:186
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:187
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:188
    end do   ! pio_decomp_tests_2d.F90.in:189
  end do   ! pio_decomp_tests_2d.F90.in:190
   ! pio_decomp_tests_2d.F90.in:191
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:192
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:193
   ! pio_decomp_tests_2d.F90.in:194
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:196
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:197
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:198
     ! pio_decomp_tests_2d.F90.in:199
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:200
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:201
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:202
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:203
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:204
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:205
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:206
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:208
    end do   ! pio_decomp_tests_2d.F90.in:209
  end do   ! pio_decomp_tests_2d.F90.in:210
   ! pio_decomp_tests_2d.F90.in:211
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:212
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:213
   ! pio_decomp_tests_2d.F90.in:214
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:215
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:216
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:217
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:218

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:219
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:220
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:221)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:221
   ! pio_decomp_tests_2d.F90.in:222
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:223
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:224
   ! pio_decomp_tests_2d.F90.in:225
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:226
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:227)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:227
   ! pio_decomp_tests_2d.F90.in:228
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:229
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:230
   ! pio_decomp_tests_2d.F90.in:231
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:232
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:233)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:233
   ! pio_decomp_tests_2d.F90.in:234
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:236
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:237)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:237
   ! pio_decomp_tests_2d.F90.in:238
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:240
   ! pio_decomp_tests_2d.F90.in:241
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:242
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:243)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:243
   ! pio_decomp_tests_2d.F90.in:244
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:245
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:246)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:246
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:248
#endif
   ! pio_decomp_tests_2d.F90.in:250
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:251
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:252)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:252
   ! pio_decomp_tests_2d.F90.in:253
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:254)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:254
   ! pio_decomp_tests_2d.F90.in:255
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:256
       ! pio_decomp_tests_2d.F90.in:257
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:258
  end do   ! pio_decomp_tests_2d.F90.in:259
   ! pio_decomp_tests_2d.F90.in:260
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:261
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:262
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:263
  end if   ! pio_decomp_tests_2d.F90.in:264
   ! pio_decomp_tests_2d.F90.in:265
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:266
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:267
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:268
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:269
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:270
END SUBROUTINE nc_write_read_2d_col_decomp_PIO_int_integer__   ! pio_decomp_tests_2d.F90.in:271


SUBROUTINE nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:158
  implicit none   ! pio_decomp_tests_2d.F90.in:159
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:160
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:161
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:162
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:163
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:164
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:165
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:166
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:167
  real(kind=fc_real), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:168
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:169
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:170
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:171
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:173
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:174
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:175
   ! pio_decomp_tests_2d.F90.in:176
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:178
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:179
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:180
     ! pio_decomp_tests_2d.F90.in:181
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:182
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:183
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:184
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:185
      wbuf(i,j) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:186
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:187
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:188
    end do   ! pio_decomp_tests_2d.F90.in:189
  end do   ! pio_decomp_tests_2d.F90.in:190
   ! pio_decomp_tests_2d.F90.in:191
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:192
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:193
   ! pio_decomp_tests_2d.F90.in:194
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:196
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:197
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:198
     ! pio_decomp_tests_2d.F90.in:199
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:200
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:201
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:202
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:203
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:204
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:205
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:206
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:208
    end do   ! pio_decomp_tests_2d.F90.in:209
  end do   ! pio_decomp_tests_2d.F90.in:210
   ! pio_decomp_tests_2d.F90.in:211
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:212
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:213
   ! pio_decomp_tests_2d.F90.in:214
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:215
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:216
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:217
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:218

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:219
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:220
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:221)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:221
   ! pio_decomp_tests_2d.F90.in:222
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:223
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:224
   ! pio_decomp_tests_2d.F90.in:225
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:226
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:227)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:227
   ! pio_decomp_tests_2d.F90.in:228
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:229
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:230
   ! pio_decomp_tests_2d.F90.in:231
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:232
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:233)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:233
   ! pio_decomp_tests_2d.F90.in:234
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:236
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:237)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:237
   ! pio_decomp_tests_2d.F90.in:238
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:240
   ! pio_decomp_tests_2d.F90.in:241
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:242
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:243)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:243
   ! pio_decomp_tests_2d.F90.in:244
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:245
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:246)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:246
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:248
#endif
   ! pio_decomp_tests_2d.F90.in:250
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:251
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:252)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:252
   ! pio_decomp_tests_2d.F90.in:253
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:254)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:254
   ! pio_decomp_tests_2d.F90.in:255
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:256
       ! pio_decomp_tests_2d.F90.in:257
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:258
  end do   ! pio_decomp_tests_2d.F90.in:259
   ! pio_decomp_tests_2d.F90.in:260
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:261
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:262
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:263
  end if   ! pio_decomp_tests_2d.F90.in:264
   ! pio_decomp_tests_2d.F90.in:265
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:266
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:267
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:268
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:269
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:270
END SUBROUTINE nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___   ! pio_decomp_tests_2d.F90.in:271


SUBROUTINE nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:158
  implicit none   ! pio_decomp_tests_2d.F90.in:159
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:160
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:161
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:162
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:163
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:164
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:165
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:166
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:167
  real(kind=fc_double), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:168
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:169
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:170
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:171
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:173
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:174
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:175
   ! pio_decomp_tests_2d.F90.in:176
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:178
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:179
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:180
     ! pio_decomp_tests_2d.F90.in:181
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:182
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:183
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:184
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:185
      wbuf(i,j) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:186
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:187
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:188
    end do   ! pio_decomp_tests_2d.F90.in:189
  end do   ! pio_decomp_tests_2d.F90.in:190
   ! pio_decomp_tests_2d.F90.in:191
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:192
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:193
   ! pio_decomp_tests_2d.F90.in:194
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_col_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:196
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:197
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:198
     ! pio_decomp_tests_2d.F90.in:199
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:200
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:201
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:202
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:203
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:204
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:205
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:206
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:208
    end do   ! pio_decomp_tests_2d.F90.in:209
  end do   ! pio_decomp_tests_2d.F90.in:210
   ! pio_decomp_tests_2d.F90.in:211
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:212
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:213
   ! pio_decomp_tests_2d.F90.in:214
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:215
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:216
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:217
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:218

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:219
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:220
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:221)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:221
   ! pio_decomp_tests_2d.F90.in:222
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:223
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:224)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:224
   ! pio_decomp_tests_2d.F90.in:225
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:226
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:227)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:227
   ! pio_decomp_tests_2d.F90.in:228
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:229
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:230)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:230
   ! pio_decomp_tests_2d.F90.in:231
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:232
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:233)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:233
   ! pio_decomp_tests_2d.F90.in:234
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:236
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:237)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:237
   ! pio_decomp_tests_2d.F90.in:238
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:240
   ! pio_decomp_tests_2d.F90.in:241
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:242
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:243)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:243
   ! pio_decomp_tests_2d.F90.in:244
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:245
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:246)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:246
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:248
#endif
   ! pio_decomp_tests_2d.F90.in:250
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:251
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:252)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:252
   ! pio_decomp_tests_2d.F90.in:253
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:254)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:254
   ! pio_decomp_tests_2d.F90.in:255
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:256
       ! pio_decomp_tests_2d.F90.in:257
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:258
  end do   ! pio_decomp_tests_2d.F90.in:259
   ! pio_decomp_tests_2d.F90.in:260
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:261
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:262
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:263
  end if   ! pio_decomp_tests_2d.F90.in:264
   ! pio_decomp_tests_2d.F90.in:265
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:266
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:267
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:268
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:269
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:270
END SUBROUTINE nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___   ! pio_decomp_tests_2d.F90.in:271
   ! pio_decomp_tests_2d.F90.in:271


! Write with one decomp (to force rearrangement) and read with another (no
! rearrangement)


SUBROUTINE nc_write_read_2d_row_decomp_PIO_int_integer__
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:276
  implicit none   ! pio_decomp_tests_2d.F90.in:277
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:278
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:279
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:280
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:281
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:282
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:283
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:284
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:285
  integer, dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:286
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:287
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:288
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:289
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:291
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:292
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:293
   ! pio_decomp_tests_2d.F90.in:294
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:296
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:297
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:298
   ! pio_decomp_tests_2d.F90.in:299
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:300
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:301
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:302
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:303
      wbuf(i,j) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:304
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:305
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:306
    end do   ! pio_decomp_tests_2d.F90.in:307
  end do   ! pio_decomp_tests_2d.F90.in:308
   ! pio_decomp_tests_2d.F90.in:309
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:310
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:311
   ! pio_decomp_tests_2d.F90.in:312
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:314
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:315
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:316
     ! pio_decomp_tests_2d.F90.in:317
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:318
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:319
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:320
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:321
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:322
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:323
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:324
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:326
    end do   ! pio_decomp_tests_2d.F90.in:327
  end do   ! pio_decomp_tests_2d.F90.in:328
   ! pio_decomp_tests_2d.F90.in:329
  call PIO_initdecomp(pio_tf_iosystem_, PIO_int, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:330
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:331
   ! pio_decomp_tests_2d.F90.in:332
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:333
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:334
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:335
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:336

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_int : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:337
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:338
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:339)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:339
   ! pio_decomp_tests_2d.F90.in:340
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:341
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:342
   ! pio_decomp_tests_2d.F90.in:343
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:344
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:345)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:345
   ! pio_decomp_tests_2d.F90.in:346
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_int, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:347
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:348
   ! pio_decomp_tests_2d.F90.in:349
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:350
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:351)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:351
   ! pio_decomp_tests_2d.F90.in:352
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:354
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:355)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:355
   ! pio_decomp_tests_2d.F90.in:356
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:358
   ! pio_decomp_tests_2d.F90.in:359
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:360
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:361)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:361
   ! pio_decomp_tests_2d.F90.in:362
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:363
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:364)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:364
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:366
#endif
   ! pio_decomp_tests_2d.F90.in:368
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:369
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:370)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:370
   ! pio_decomp_tests_2d.F90.in:371
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:372)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:372
   ! pio_decomp_tests_2d.F90.in:373
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:374
       ! pio_decomp_tests_2d.F90.in:375
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:376
  end do   ! pio_decomp_tests_2d.F90.in:377
   ! pio_decomp_tests_2d.F90.in:378
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:379
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:380
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:381
  end if   ! pio_decomp_tests_2d.F90.in:382
   ! pio_decomp_tests_2d.F90.in:383
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:384
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:385
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:386
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:387
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:388
END SUBROUTINE nc_write_read_2d_row_decomp_PIO_int_integer__   ! pio_decomp_tests_2d.F90.in:389


SUBROUTINE nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:276
  implicit none   ! pio_decomp_tests_2d.F90.in:277
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:278
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:279
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:280
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:281
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:282
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:283
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:284
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:285
  real(kind=fc_real), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:286
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:287
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:288
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:289
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:291
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:292
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:293
   ! pio_decomp_tests_2d.F90.in:294
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:296
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:297
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:298
   ! pio_decomp_tests_2d.F90.in:299
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:300
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:301
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:302
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:303
      wbuf(i,j) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:304
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:305
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:306
    end do   ! pio_decomp_tests_2d.F90.in:307
  end do   ! pio_decomp_tests_2d.F90.in:308
   ! pio_decomp_tests_2d.F90.in:309
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:310
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:311
   ! pio_decomp_tests_2d.F90.in:312
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:314
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:315
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:316
     ! pio_decomp_tests_2d.F90.in:317
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:318
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:319
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:320
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:321
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:322
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:323
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:324
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:326
    end do   ! pio_decomp_tests_2d.F90.in:327
  end do   ! pio_decomp_tests_2d.F90.in:328
   ! pio_decomp_tests_2d.F90.in:329
  call PIO_initdecomp(pio_tf_iosystem_, PIO_real, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:330
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:331
   ! pio_decomp_tests_2d.F90.in:332
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:333
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:334
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:335
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:336

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_real : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:337
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:338
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:339)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:339
   ! pio_decomp_tests_2d.F90.in:340
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:341
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:342
   ! pio_decomp_tests_2d.F90.in:343
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:344
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:345)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:345
   ! pio_decomp_tests_2d.F90.in:346
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_real, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:347
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:348
   ! pio_decomp_tests_2d.F90.in:349
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:350
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:351)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:351
   ! pio_decomp_tests_2d.F90.in:352
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:354
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:355)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:355
   ! pio_decomp_tests_2d.F90.in:356
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:358
   ! pio_decomp_tests_2d.F90.in:359
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:360
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:361)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:361
   ! pio_decomp_tests_2d.F90.in:362
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:363
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:364)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:364
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:366
#endif
   ! pio_decomp_tests_2d.F90.in:368
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:369
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:370)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:370
   ! pio_decomp_tests_2d.F90.in:371
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:372)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:372
   ! pio_decomp_tests_2d.F90.in:373
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:374
       ! pio_decomp_tests_2d.F90.in:375
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:376
  end do   ! pio_decomp_tests_2d.F90.in:377
   ! pio_decomp_tests_2d.F90.in:378
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:379
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:380
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:381
  end if   ! pio_decomp_tests_2d.F90.in:382
   ! pio_decomp_tests_2d.F90.in:383
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:384
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:385
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:386
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:387
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:388
END SUBROUTINE nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___   ! pio_decomp_tests_2d.F90.in:389


SUBROUTINE nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___
USE pio_tutil
   ! pio_decomp_tests_2d.F90.in:276
  implicit none   ! pio_decomp_tests_2d.F90.in:277
  type(var_desc_t)  :: pio_var   ! pio_decomp_tests_2d.F90.in:278
  type(file_desc_t) :: pio_file   ! pio_decomp_tests_2d.F90.in:279
  integer, parameter :: NDIMS = 2   ! pio_decomp_tests_2d.F90.in:280
  character(len=PIO_TF_MAX_STR_LEN) :: filename   ! pio_decomp_tests_2d.F90.in:281
  character(len=*), parameter :: PIO_VAR_NAME = 'PIO_TF_test_var'   ! pio_decomp_tests_2d.F90.in:282
  type(io_desc_t) :: wr_iodesc, rd_iodesc   ! pio_decomp_tests_2d.F90.in:283
  integer, dimension(:), allocatable :: compdof   ! pio_decomp_tests_2d.F90.in:284
  integer, dimension(NDIMS) :: start, count   ! pio_decomp_tests_2d.F90.in:285
  real(kind=fc_double), dimension(:,:), allocatable :: rbuf, wbuf, exp_val   ! pio_decomp_tests_2d.F90.in:286
  integer, dimension(NDIMS) :: dims   ! pio_decomp_tests_2d.F90.in:287
  integer, dimension(NDIMS) :: pio_dims   ! pio_decomp_tests_2d.F90.in:288
  integer :: i, j, tmp_idx, ierr, lsz, nrows, ncols   ! pio_decomp_tests_2d.F90.in:289
  ! iotypes = valid io types
  integer, dimension(:), allocatable :: iotypes   ! pio_decomp_tests_2d.F90.in:291
  character(len=PIO_TF_MAX_STR_LEN), dimension(:), allocatable :: iotype_descs   ! pio_decomp_tests_2d.F90.in:292
  integer :: num_iotypes   ! pio_decomp_tests_2d.F90.in:293
   ! pio_decomp_tests_2d.F90.in:294
  ! Set the decomposition for writing data - forcing rearrangement
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .true.)   ! pio_decomp_tests_2d.F90.in:296
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:297
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:298
   ! pio_decomp_tests_2d.F90.in:299
  allocate(wbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:300
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:301
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:302
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:303
      wbuf(i,j) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:304
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:305
      compdof(tmp_idx) = wbuf(i,j)   ! pio_decomp_tests_2d.F90.in:306
    end do   ! pio_decomp_tests_2d.F90.in:307
  end do   ! pio_decomp_tests_2d.F90.in:308
   ! pio_decomp_tests_2d.F90.in:309
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:310
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:311
   ! pio_decomp_tests_2d.F90.in:312
  ! Set the decomposition for reading data - different from the write decomp
  call get_2d_row_decomp_info(pio_tf_world_rank_, pio_tf_world_sz_, dims, start, count, .false.)   ! pio_decomp_tests_2d.F90.in:314
  nrows = count(1)   ! pio_decomp_tests_2d.F90.in:315
  ncols = count(2)   ! pio_decomp_tests_2d.F90.in:316
     ! pio_decomp_tests_2d.F90.in:317
  allocate(rbuf(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:318
  allocate(compdof(nrows * ncols))   ! pio_decomp_tests_2d.F90.in:319
  allocate(exp_val(nrows, ncols))   ! pio_decomp_tests_2d.F90.in:320
  do j=1,ncols   ! pio_decomp_tests_2d.F90.in:321
    do i=1,nrows   ! pio_decomp_tests_2d.F90.in:322
      tmp_idx = (j - 1) * nrows + i   ! pio_decomp_tests_2d.F90.in:323
      compdof(tmp_idx) = (start(2) - 1 + j - 1) * dims(1) + start(1) + i - 1   ! pio_decomp_tests_2d.F90.in:324
      ! Expected value, after reading, is the same as the compdof
      exp_val(i,j) = compdof(tmp_idx)   ! pio_decomp_tests_2d.F90.in:326
    end do   ! pio_decomp_tests_2d.F90.in:327
  end do   ! pio_decomp_tests_2d.F90.in:328
   ! pio_decomp_tests_2d.F90.in:329
  call PIO_initdecomp(pio_tf_iosystem_, PIO_double, dims, compdof, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:330
  deallocate(compdof)   ! pio_decomp_tests_2d.F90.in:331
   ! pio_decomp_tests_2d.F90.in:332
  num_iotypes = 0   ! pio_decomp_tests_2d.F90.in:333
  call PIO_TF_Get_nc_iotypes(iotypes, iotype_descs, num_iotypes)   ! pio_decomp_tests_2d.F90.in:334
  filename = "test_pio_decomp_simple_tests.testfile"   ! pio_decomp_tests_2d.F90.in:335
  do i=1,num_iotypes   ! pio_decomp_tests_2d.F90.in:336

    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_log_level_ >= 0) THEN
        WRITE(*,"(A)",ADVANCE="NO") "PIO_TF: "
        WRITE(*,*)  "Testing : PIO_double : ", iotype_descs(i)
      END IF
    END IF   ! pio_decomp_tests_2d.F90.in:337
    ierr = PIO_createfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_CLOBBER)    ! pio_decomp_tests_2d.F90.in:338
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not create file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:339)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:339
   ! pio_decomp_tests_2d.F90.in:340
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_row', dims(1), pio_dims(1))   ! pio_decomp_tests_2d.F90.in:341
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:342)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:342
   ! pio_decomp_tests_2d.F90.in:343
    ierr = PIO_def_dim(pio_file, 'PIO_TF_test_dim_col', dims(2), pio_dims(2))   ! pio_decomp_tests_2d.F90.in:344
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a dim : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:345)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:345
   ! pio_decomp_tests_2d.F90.in:346
    ierr = PIO_def_var(pio_file, PIO_VAR_NAME, PIO_double, pio_dims, pio_var)   ! pio_decomp_tests_2d.F90.in:347
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to define a var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:348)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:348
   ! pio_decomp_tests_2d.F90.in:349
    ierr = PIO_enddef(pio_file)   ! pio_decomp_tests_2d.F90.in:350
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to end redef mode : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:351)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:351
   ! pio_decomp_tests_2d.F90.in:352
    ! Write the variable out
    call PIO_write_darray(pio_file, pio_var, wr_iodesc, wbuf, ierr)   ! pio_decomp_tests_2d.F90.in:354
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to write darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:355)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:355
   ! pio_decomp_tests_2d.F90.in:356
#ifdef PIO_TEST_CLOSE_OPEN_FOR_SYNC
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:358
   ! pio_decomp_tests_2d.F90.in:359
    ierr = PIO_openfile(pio_tf_iosystem_, pio_file, iotypes(i), filename, PIO_nowrite)   ! pio_decomp_tests_2d.F90.in:360
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not reopen file " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:361)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:361
   ! pio_decomp_tests_2d.F90.in:362
    ierr = PIO_inq_varid(pio_file, PIO_VAR_NAME, pio_var)   ! pio_decomp_tests_2d.F90.in:363
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Could not inq var : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:364)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:364
#else
    call PIO_syncfile(pio_file)   ! pio_decomp_tests_2d.F90.in:366
#endif
   ! pio_decomp_tests_2d.F90.in:368
    call PIO_read_darray(pio_file, pio_var, rd_iodesc, rbuf, ierr)   ! pio_decomp_tests_2d.F90.in:369
    
    IF (.NOT. (PIO_TF_Passert_((ierr) == PIO_NOERR, pio_tf_comm_))) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Function failed:",&
           "Failed to read darray : " // trim(filename),&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:370)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:370
   ! pio_decomp_tests_2d.F90.in:371
    
    IF (.NOT. PIO_TF_Check_val_(rbuf, exp_val)) THEN
      pio_tf_retval_utest_ = -1
      IF (pio_tf_world_rank_ == 0) THEN
        PRINT *, "PIO_TF: PIO Check failed:",&
           "Got wrong val",&
          ":", __FILE__, ":", __LINE__,&
          "(pio_decomp_tests_2d.F90.in:372)"
      END IF
      RETURN
    END IF   ! pio_decomp_tests_2d.F90.in:372
   ! pio_decomp_tests_2d.F90.in:373
    call PIO_closefile(pio_file)   ! pio_decomp_tests_2d.F90.in:374
       ! pio_decomp_tests_2d.F90.in:375
    call PIO_deletefile(pio_tf_iosystem_, filename);   ! pio_decomp_tests_2d.F90.in:376
  end do   ! pio_decomp_tests_2d.F90.in:377
   ! pio_decomp_tests_2d.F90.in:378
  if(allocated(iotypes)) then   ! pio_decomp_tests_2d.F90.in:379
    deallocate(iotypes)   ! pio_decomp_tests_2d.F90.in:380
    deallocate(iotype_descs)   ! pio_decomp_tests_2d.F90.in:381
  end if   ! pio_decomp_tests_2d.F90.in:382
   ! pio_decomp_tests_2d.F90.in:383
  call PIO_freedecomp(pio_tf_iosystem_, rd_iodesc)   ! pio_decomp_tests_2d.F90.in:384
  call PIO_freedecomp(pio_tf_iosystem_, wr_iodesc)   ! pio_decomp_tests_2d.F90.in:385
  deallocate(exp_val)   ! pio_decomp_tests_2d.F90.in:386
  deallocate(rbuf)   ! pio_decomp_tests_2d.F90.in:387
  deallocate(wbuf)   ! pio_decomp_tests_2d.F90.in:388
END SUBROUTINE nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___   ! pio_decomp_tests_2d.F90.in:389
   ! pio_decomp_tests_2d.F90.in:389


  SUBROUTINE PIO_TF_Test_driver_
    USE pio_tutil
    IMPLICIT NONE
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_int_integer__"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_write_read_2d_col_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 1:",&
          "nc_write_read_2d_col_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 2:",&
          "nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 3:",&
          "nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_int_integer__"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_write_read_2d_col_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 4:",&
          "nc_write_read_2d_col_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 5:",&
          "nc_write_read_2d_col_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 6:",&
          "nc_write_read_2d_col_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_row_decomp_PIO_int_integer__"
    END IF
    CALL nc_write_read_2d_row_decomp_PIO_int_integer__()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_write_read_2d_row_decomp_PIO_int_integer__","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 7:",&
          "nc_write_read_2d_row_decomp_PIO_int_integer__","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___"
    END IF
    CALL nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 8:",&
          "nc_write_read_2d_row_decomp_PIO_real_real_kind_fc_real___","-----------", "FAILED"
      END IF
    END IF
    pio_tf_retval_utest_ = 0
    IF (pio_tf_world_rank_ == 0) THEN
      PRINT *, "PIO_TF: Starting nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___"
    END IF
    CALL nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___()
    IF (pio_tf_retval_utest_ /= 0) THEN
      pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
    END IF
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_retval_utest_ == 0) THEN
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___","-----------", "PASSED"
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF:Test 9:",&
          "nc_write_read_2d_row_decomp_PIO_double_real_kind_fc_double___","-----------", "FAILED"
      END IF
    END IF
  END SUBROUTINE PIO_TF_Test_driver_


  PROGRAM PIO_TF_Test_main_
    USE pio_tutil
    IMPLICIT NONE
    INTEGER, PARAMETER :: NREARRS = 2
    INTEGER :: rearrs(NREARRS) = (/pio_rearr_subset,pio_rearr_box/)
    CHARACTER(LEN=PIO_TF_MAX_STR_LEN) :: rearrs_info(NREARRS) = (/"PIO_REARR_SUBSET","PIO_REARR_BOX   "/)
    INTEGER i, ierr

    pio_tf_nerrs_total_=0
    pio_tf_retval_utest_=0
    CALL MPI_Init(ierr)
    DO i=1,SIZE(rearrs)
      CALL PIO_TF_Init_(rearrs(i))
      IF (pio_tf_world_rank_ == 0) THEN
        WRITE(*,*) "PIO_TF: Testing : ", trim(rearrs_info(i))
      END IF
      CALL PIO_TF_Test_driver_()
      CALL PIO_TF_Finalize_()
    END DO
    IF (pio_tf_world_rank_ == 0) THEN
      IF (pio_tf_nerrs_total_ == 0) THEN
        IF (pio_tf_retval_utest_ == 0) THEN
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "All tests", "---------", "PASSED"
        ELSE
          pio_tf_nerrs_total_ = pio_tf_nerrs_total_ + 1
          WRITE(*,PIO_TF_TEST_RES_FMT) "PIO_TF: ",&
           "Test driver", "---------", "FAILED"
        END IF
      ELSE
        WRITE(*,PIO_TF_TEST_RES_FMT2) "PIO_TF:[",&
          pio_tf_nerrs_total_,"] Tests",&
          "----- FAILED"
      END IF
    END IF
    CALL MPI_Finalize(ierr)
    IF (pio_tf_nerrs_total_ /= 0) THEN
      STOP 99
    END IF
  END PROGRAM
